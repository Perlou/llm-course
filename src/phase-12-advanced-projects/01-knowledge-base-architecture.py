"""
ä¼ä¸šçº§çŸ¥è¯†åº“ç³»ç»Ÿ - æ¶æ„è®¾è®¡
========================

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£ä¼ä¸šçº§çŸ¥è¯†åº“çš„æ¶æ„è®¾è®¡
    2. æŒæ¡æŠ€æœ¯é€‰å‹å’Œç³»ç»Ÿåˆ†å±‚
    3. è®¾è®¡å¯æ‰©å±•çš„ RAG ç³»ç»Ÿ

é¡¹ç›®æ¦‚è¿°ï¼š
    æ„å»ºä¸€ä¸ªæ”¯æŒå¤šç”¨æˆ·ã€å¤šæ–‡æ¡£æ ¼å¼ã€é«˜å¹¶å‘çš„ä¼ä¸šçº§çŸ¥è¯†åº“ç³»ç»Ÿï¼Œ
    æ”¯æŒæ™ºèƒ½é—®ç­”ã€æƒé™ç®¡ç†ã€æ•°æ®åˆ†æç­‰åŠŸèƒ½ã€‚

æŠ€æœ¯æ ˆï¼š
    - åç«¯ï¼šFastAPI + LangChain
    - å‘é‡åº“ï¼šMilvus / Qdrant
    - æ•°æ®åº“ï¼šPostgreSQL + Redis
    - LLMï¼šGPT-4 / Claude / å¼€æºæ¨¡å‹
"""


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šéœ€æ±‚åˆ†æ ====================


def requirements():
    """éœ€æ±‚åˆ†æ"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šéœ€æ±‚åˆ†æ")
    print("=" * 60)

    print("""
    ğŸ“Œ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. æ–‡æ¡£ç®¡ç†                                            â”‚
    â”‚    - å¤šæ ¼å¼æ”¯æŒï¼šPDF, Word, Excel, Markdown, HTML      â”‚
    â”‚    - æ‰¹é‡ä¸Šä¼ å’Œå¤„ç†                                    â”‚
    â”‚    - æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†                                      â”‚
    â”‚                                                        â”‚
    â”‚ 2. æ™ºèƒ½é—®ç­”                                            â”‚
    â”‚    - åŸºäº RAG çš„ç²¾å‡†é—®ç­”                               â”‚
    â”‚    - å¤šè½®å¯¹è¯æ”¯æŒ                                      â”‚
    â”‚    - å¼•ç”¨æº¯æº                                          â”‚
    â”‚                                                        â”‚
    â”‚ 3. æƒé™ç®¡ç†                                            â”‚
    â”‚    - ç”¨æˆ·è®¤è¯ä¸æˆæƒ                                    â”‚
    â”‚    - æ–‡æ¡£çº§åˆ«æƒé™æ§åˆ¶                                  â”‚
    â”‚    - çŸ¥è¯†åº“éš”ç¦»                                        â”‚
    â”‚                                                        â”‚
    â”‚ 4. è¿è¥ç®¡ç†                                            â”‚
    â”‚    - ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ                                    â”‚
    â”‚    - é—®ç­”è´¨é‡ç›‘æ§                                      â”‚
    â”‚    - æˆæœ¬è¿½è¸ª                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“Œ éåŠŸèƒ½éœ€æ±‚ï¼š
    - å¹¶å‘æ”¯æŒï¼š100+ QPS
    - å“åº”æ—¶é—´ï¼š< 3s
    - å¯ç”¨æ€§ï¼š99.9%
    - æ•°æ®å®‰å…¨ï¼šä¼ä¸šçº§åŠ å¯†
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šæ¶æ„è®¾è®¡ ====================


def architecture():
    """æ¶æ„è®¾è®¡"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šç³»ç»Ÿæ¶æ„è®¾è®¡")
    print("=" * 60)

    print("""
    ğŸ“Œ æ•´ä½“æ¶æ„ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        å‰ç«¯å±‚                               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚  â”‚  Web UI  â”‚ â”‚  ç§»åŠ¨ç«¯  â”‚ â”‚   API    â”‚ â”‚  æ’ä»¶    â”‚       â”‚
    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚            â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      API ç½‘å…³å±‚                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  è®¤è¯/æˆæƒ  â”‚  é™æµ  â”‚  è´Ÿè½½å‡è¡¡  â”‚  æ—¥å¿—  â”‚  ç›‘æ§  â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       æœåŠ¡å±‚                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  â”‚  é—®ç­”æœåŠ¡  â”‚ â”‚  æ–‡æ¡£æœåŠ¡  â”‚ â”‚  ç”¨æˆ·æœåŠ¡  â”‚              â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  â”‚ æ£€ç´¢æœåŠ¡   â”‚ â”‚ å‘é‡æœåŠ¡   â”‚ â”‚ åˆ†ææœåŠ¡   â”‚              â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       å­˜å‚¨å±‚                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚  â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚  Milvus  â”‚ â”‚   OSS    â”‚       â”‚
    â”‚  â”‚ (å…ƒæ•°æ®) â”‚ â”‚  (ç¼“å­˜)  â”‚ â”‚ (å‘é‡åº“) â”‚ â”‚ (æ–‡ä»¶)   â”‚       â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“Œ æ ¸å¿ƒæœåŠ¡èŒè´£ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é—®ç­”æœåŠ¡   â”‚ RAG æ£€ç´¢ã€LLM ç”Ÿæˆã€å¯¹è¯ç®¡ç†             â”‚
    â”‚ æ–‡æ¡£æœåŠ¡   â”‚ æ–‡æ¡£è§£æã€åˆ†å—ã€ç´¢å¼•ç®¡ç†                 â”‚
    â”‚ æ£€ç´¢æœåŠ¡   â”‚ å‘é‡æ£€ç´¢ã€æ··åˆæ£€ç´¢ã€é‡æ’åº               â”‚
    â”‚ å‘é‡æœåŠ¡   â”‚ Embedding ç”Ÿæˆã€å‘é‡åº“ç®¡ç†               â”‚
    â”‚ ç”¨æˆ·æœåŠ¡   â”‚ è®¤è¯æˆæƒã€æƒé™ç®¡ç†                       â”‚
    â”‚ åˆ†ææœåŠ¡   â”‚ ç»Ÿè®¡åˆ†æã€æŠ¥è¡¨ç”Ÿæˆ                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ€æœ¯é€‰å‹ ====================


def tech_stack():
    """æŠ€æœ¯é€‰å‹"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ€æœ¯é€‰å‹")
    print("=" * 60)

    print("""
    ğŸ“Œ æŠ€æœ¯æ ˆé€‰æ‹©ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   å±‚çº§      â”‚    æŠ€æœ¯é€‰å‹    â”‚         ç†ç”±               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Webæ¡†æ¶     â”‚ FastAPI        â”‚ é«˜æ€§èƒ½ã€å¼‚æ­¥ã€OpenAPI      â”‚
    â”‚ LLMæ¡†æ¶     â”‚ LangChain      â”‚ ç”Ÿæ€ä¸°å¯Œã€æŠ½è±¡å®Œå–„         â”‚
    â”‚ å‘é‡æ•°æ®åº“  â”‚ Milvus/Qdrant  â”‚ é«˜æ€§èƒ½ã€å¯æ‰©å±•             â”‚
    â”‚ å…³ç³»æ•°æ®åº“  â”‚ PostgreSQL     â”‚ ç¨³å®šå¯é ã€åŠŸèƒ½ä¸°å¯Œ         â”‚
    â”‚ ç¼“å­˜        â”‚ Redis          â”‚ é«˜æ€§èƒ½ã€å¤šæ•°æ®ç»“æ„         â”‚
    â”‚ æ¶ˆæ¯é˜Ÿåˆ—    â”‚ Celery+Redis   â”‚ å¼‚æ­¥ä»»åŠ¡å¤„ç†               â”‚
    â”‚ å¯¹è±¡å­˜å‚¨    â”‚ MinIO/S3       â”‚ æ–‡ä»¶å­˜å‚¨                   â”‚
    â”‚ å®¹å™¨åŒ–      â”‚ Docker+K8s     â”‚ éƒ¨ç½²è¿ç»´æ ‡å‡†åŒ–             â”‚
    â”‚ ç›‘æ§        â”‚ Prometheus     â”‚ æŒ‡æ ‡é‡‡é›†å’Œå‘Šè­¦             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“Œ LLM é€‰å‹ç­–ç•¥ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åœºæ™¯           â”‚ æ¨èæ¨¡å‹                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ å¤æ‚é—®ç­”       â”‚ GPT-4o / Claude 3.5                    â”‚
    â”‚ ç®€å•é—®ç­”       â”‚ GPT-4o-mini / Claude 3 Haiku           â”‚
    â”‚ Embedding      â”‚ text-embedding-3-small                  â”‚
    â”‚ ç§æœ‰åŒ–éƒ¨ç½²     â”‚ Qwen2 / GLM-4 / Llama 3                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šRAG æµç¨‹è®¾è®¡ ====================


def rag_design():
    """RAG æµç¨‹è®¾è®¡"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šRAG æµç¨‹è®¾è®¡")
    print("=" * 60)

    print("""
    ğŸ“Œ æ–‡æ¡£å¤„ç†æµç¨‹ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ–‡æ¡£   â”‚ -> â”‚ è§£æ   â”‚ -> â”‚ åˆ†å—   â”‚ -> â”‚ å‘é‡åŒ– â”‚
    â”‚ ä¸Šä¼    â”‚    â”‚ æå–   â”‚    â”‚ ç­–ç•¥   â”‚    â”‚ å­˜å‚¨   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“Œ é—®ç­”æµç¨‹ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç”¨æˆ·   â”‚ -> â”‚ æŸ¥è¯¢   â”‚ -> â”‚ å‘é‡   â”‚ -> â”‚ é‡æ’åº â”‚ -> â”‚ LLM    â”‚
    â”‚ æé—®   â”‚    â”‚ æ”¹å†™   â”‚    â”‚ æ£€ç´¢   â”‚    â”‚ è¿‡æ»¤   â”‚    â”‚ ç”Ÿæˆ   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“Œ åˆ†å—ç­–ç•¥ï¼š
    - é»˜è®¤ï¼šRecursiveCharacterTextSplitter
    - chunk_size: 500-1000
    - overlap: 100-200
    - ä¿ç•™å…ƒæ•°æ®ï¼šæ ‡é¢˜ã€æ¥æºã€é¡µç 

    ğŸ“Œ æ£€ç´¢ç­–ç•¥ï¼š
    - æ··åˆæ£€ç´¢ï¼šå‘é‡ + å…³é”®è¯
    - top_k: 10-20
    - Reranker é‡æ’åº
    - ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤
    """)


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®åº“è®¾è®¡ ====================


def database_design():
    """æ•°æ®åº“è®¾è®¡"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®åº“è®¾è®¡")
    print("=" * 60)

    code = '''
# PostgreSQL è¡¨ç»“æ„è®¾è®¡

"""
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- çŸ¥è¯†åº“è¡¨
CREATE TABLE knowledge_bases (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    owner_id UUID REFERENCES users(id),
    is_public BOOLEAN DEFAULT FALSE,
    settings JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    kb_id UUID REFERENCES knowledge_bases(id),
    filename VARCHAR(255) NOT NULL,
    file_type VARCHAR(50),
    file_size INTEGER,
    file_path VARCHAR(500),
    chunk_count INTEGER DEFAULT 0,
    status VARCHAR(50) DEFAULT 'pending',
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å¯¹è¯è¡¨
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    kb_id UUID REFERENCES knowledge_bases(id),
    title VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID REFERENCES conversations(id),
    role VARCHAR(20) NOT NULL,
    content TEXT NOT NULL,
    sources JSONB,
    tokens_used INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
"""
'''
    print(code)


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šAPI è®¾è®¡ ====================


def api_design():
    """API è®¾è®¡"""
    print("\n" + "=" * 60)
    print("ç¬¬å…­éƒ¨åˆ†ï¼šAPI è®¾è®¡")
    print("=" * 60)

    print("""
    ğŸ“Œ æ ¸å¿ƒ API ç«¯ç‚¹ï¼š

    # çŸ¥è¯†åº“ç®¡ç†
    POST   /api/v1/knowledge-bases          åˆ›å»ºçŸ¥è¯†åº“
    GET    /api/v1/knowledge-bases          è·å–çŸ¥è¯†åº“åˆ—è¡¨
    GET    /api/v1/knowledge-bases/{id}     è·å–çŸ¥è¯†åº“è¯¦æƒ…
    DELETE /api/v1/knowledge-bases/{id}     åˆ é™¤çŸ¥è¯†åº“

    # æ–‡æ¡£ç®¡ç†
    POST   /api/v1/documents/upload         ä¸Šä¼ æ–‡æ¡£
    GET    /api/v1/documents                è·å–æ–‡æ¡£åˆ—è¡¨
    DELETE /api/v1/documents/{id}           åˆ é™¤æ–‡æ¡£
    POST   /api/v1/documents/{id}/reindex   é‡æ–°ç´¢å¼•

    # é—®ç­”
    POST   /api/v1/chat                     å‘é€æ¶ˆæ¯ï¼ˆæ”¯æŒæµå¼ï¼‰
    GET    /api/v1/conversations            è·å–å¯¹è¯å†å²
    DELETE /api/v1/conversations/{id}       åˆ é™¤å¯¹è¯

    # ç”¨æˆ·ç®¡ç†
    POST   /api/v1/auth/login               ç™»å½•
    POST   /api/v1/auth/register            æ³¨å†Œ
    GET    /api/v1/users/me                 å½“å‰ç”¨æˆ·ä¿¡æ¯
    """)


# ==================== ç¬¬ä¸ƒéƒ¨åˆ†ï¼šç»ƒä¹  ====================


def exercises():
    """ç»ƒä¹ """
    print("\n" + "=" * 60)
    print("ä¸‹ä¸€æ­¥ï¼š02-knowledge-base-implementation.py")
    print("=" * 60)

    print("""
    å®Œæˆæ¶æ„è®¾è®¡åï¼Œä¸‹ä¸€æ­¥å°†è¿›è¡Œå®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š
    1. é¡¹ç›®ç»“æ„æ­å»º
    2. æ ¸å¿ƒæœåŠ¡å®ç°
    3. API å¼€å‘
    4. éƒ¨ç½²é…ç½®
    """)


def main():
    requirements()
    architecture()
    tech_stack()
    rag_design()
    database_design()
    api_design()
    exercises()


if __name__ == "__main__":
    main()
