"""
å¤š Agent ç³»ç»Ÿæ¦‚è¿°
=================

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£ä»€ä¹ˆæ˜¯å¤š Agent ç³»ç»Ÿ
    2. æŒæ¡å¤š Agent vs å• Agent çš„åŒºåˆ«
    3. äº†è§£å¤š Agent ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶
    4. ç†è§£å¤š Agent çš„åº”ç”¨åœºæ™¯

æ ¸å¿ƒæ¦‚å¿µï¼š
    - å¤š Agent ç³»ç»Ÿ (Multi-Agent System, MAS)
    - Agent é—´åä½œä¸é€šä¿¡
    - åˆ†å¸ƒå¼é—®é¢˜è§£å†³

å‰ç½®çŸ¥è¯†ï¼š
    - Phase 6: Agent ä¸å·¥å…·åŸºç¡€
    - å¼‚æ­¥ç¼–ç¨‹åŸºç¡€

ç¯å¢ƒè¦æ±‚ï¼š
    - pip install openai python-dotenv
"""

import os
from dotenv import load_dotenv

load_dotenv()


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯å¤š Agent ç³»ç»Ÿ ====================


def what_is_multi_agent():
    """å¤š Agent ç³»ç»Ÿæ¦‚è¿°"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯å¤š Agent ç³»ç»Ÿ")
    print("=" * 60)

    print("""
    å¤š Agent ç³»ç»Ÿ (Multi-Agent System, MAS)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    å¤šä¸ª Agent ååŒå·¥ä½œï¼Œå…±åŒå®Œæˆå¤æ‚ä»»åŠ¡çš„ç³»ç»Ÿæ¶æ„ã€‚
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               Multi-Agent System                     â”‚
    â”‚                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚   â”‚ Agent A â”‚â—„â”€â”€â–ºâ”‚ Agent B â”‚â—„â”€â”€â–ºâ”‚ Agent C â”‚       â”‚
    â”‚   â”‚ (è§„åˆ’)  â”‚    â”‚ (æ‰§è¡Œ)  â”‚    â”‚ (éªŒè¯)  â”‚       â”‚
    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
    â”‚        â”‚              â”‚              â”‚             â”‚
    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
    â”‚                       â–¼                            â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚          â”‚     å…±äº«ç¯å¢ƒ/çŸ¥è¯†åº“      â”‚               â”‚
    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                                                     â”‚
    â”‚   æ ¸å¿ƒç‰¹ç‚¹ï¼šè‡ªä¸»æ€§ | åä½œæ€§ | åˆ†å¸ƒå¼ | ä¸“ä¸šåŒ–       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ç°å®ä¸–ç•Œç±»æ¯”ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ğŸ¢ å…¬å¸å›¢é˜Ÿï¼šäº§å“ç»ç† + å¼€å‘å·¥ç¨‹å¸ˆ + æµ‹è¯•å·¥ç¨‹å¸ˆ + è¿ç»´
    ğŸ¥ åŒ»ç–—å›¢é˜Ÿï¼šä¸»æ²»åŒ»ç”Ÿ + ä¸“ç§‘åŒ»ç”Ÿ + æŠ¤å£« + è¯å‰‚å¸ˆ
    ğŸ“° æ–°é—»å›¢é˜Ÿï¼šè®°è€… + ç¼–è¾‘ + æ ¡å¯¹ + æ‘„å½±å¸ˆ
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šå• Agent vs å¤š Agent ====================


def single_vs_multi_agent():
    """å• Agent ä¸å¤š Agent å¯¹æ¯”"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šå• Agent vs å¤š Agent")
    print("=" * 60)

    print("""
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     ç»´åº¦       â”‚      å• Agent       â”‚        å¤š Agent         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  ä»»åŠ¡å¤æ‚åº¦    â”‚  ç®€å•åˆ°ä¸­ç­‰          â”‚   å¤æ‚ä»»åŠ¡              â”‚
    â”‚  ä¸“ä¸šæ€§        â”‚  é€šç”¨å‹ï¼Œä»€ä¹ˆéƒ½åš     â”‚   å„å¸å…¶èŒï¼Œä¸“ä¸šåˆ†å·¥    â”‚
    â”‚  å¯æ‰©å±•æ€§      â”‚  æœ‰é™ï¼Œéš¾ä»¥æ‰©å±•       â”‚   é«˜åº¦å¯æ‰©å±•            â”‚
    â”‚  å®¹é”™èƒ½åŠ›      â”‚  å•ç‚¹æ•…éšœ            â”‚   åˆ†å¸ƒå¼å®¹é”™            â”‚
    â”‚  å¼€å‘å¤æ‚åº¦    â”‚  ä½                  â”‚   ä¸­åˆ°é«˜                â”‚
    â”‚  é€šä¿¡å¼€é”€      â”‚  æ—                   â”‚   éœ€è¦åè°ƒé€šä¿¡          â”‚
    â”‚  é€‚ç”¨åœºæ™¯      â”‚  é—®ç­”ã€ç®€å•ä»»åŠ¡       â”‚   è½¯ä»¶å¼€å‘ã€ç ”ç©¶ã€åˆ›ä½œ  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¤š Agentï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    âœ… ä»»åŠ¡å¯ä»¥è‡ªç„¶åˆ†è§£ä¸ºå¤šä¸ªå­ä»»åŠ¡
    âœ… ä¸åŒå­ä»»åŠ¡éœ€è¦ä¸åŒçš„ä¸“ä¸šçŸ¥è¯†
    âœ… éœ€è¦å¤šè§’åº¦å®¡æŸ¥æˆ–éªŒè¯
    âœ… ä»»åŠ¡æ¶‰åŠåˆ›æ„å’Œæ‰¹è¯„çš„å¾ªç¯
    âœ… éœ€è¦æ¨¡æ‹Ÿå›¢é˜Ÿåä½œåœºæ™¯
    
    âŒ ç®€å•çš„é—®ç­”ä»»åŠ¡
    âŒ å•ä¸€æ˜ç¡®çš„æ“ä½œ
    âŒ å¯¹å“åº”é€Ÿåº¦è¦æ±‚æé«˜çš„åœºæ™¯
    """)


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¤š Agent æ ¸å¿ƒç»„ä»¶ ====================


def multi_agent_components():
    """å¤š Agent ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¤š Agent æ ¸å¿ƒç»„ä»¶")
    print("=" * 60)

    print("""
    1. Agentï¼ˆæ™ºèƒ½ä½“ï¼‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ç³»ç»Ÿä¸­çš„åŸºæœ¬å•å…ƒï¼Œå…·æœ‰è‡ªä¸»å†³ç­–èƒ½åŠ›
    
    2. é€šä¿¡åè®®
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Agent ä¹‹é—´å¦‚ä½•äº¤æ¢ä¿¡æ¯
    - æ¶ˆæ¯ä¼ é€’
    - å…±äº«é»‘æ¿
    - è®¢é˜…å‘å¸ƒ
    
    3. åè°ƒæœºåˆ¶
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¦‚ä½•ç»„ç»‡ Agent ååŒå·¥ä½œ
    - å±‚çº§å¼ï¼šä¸»ç®¡-å·¥äººæ¨¡å¼
    - æ‰å¹³å¼ï¼šå¯¹ç­‰åä½œ
    - æµæ°´çº¿å¼ï¼šé¡ºåºå¤„ç†
    
    4. å…±äº«çŠ¶æ€
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Agent å…±äº«çš„ä¿¡æ¯å’ŒçŸ¥è¯†
    - å…±äº«å†…å­˜
    - é»‘æ¿ç³»ç»Ÿ
    - åˆ†å¸ƒå¼çŠ¶æ€
    """)

    # ä»£ç ç¤ºä¾‹ï¼šAgent åŸºç¡€ç»“æ„
    print("\nğŸ“Œ ä»£ç ç¤ºä¾‹ï¼šAgent åŸºç¡€ç»“æ„")

    from abc import ABC, abstractmethod
    from dataclasses import dataclass, field
    from typing import Dict, List, Any, Optional
    from enum import Enum
    import uuid

    class AgentRole(Enum):
        """Agent è§’è‰²ç±»å‹"""

        COORDINATOR = "coordinator"  # åè°ƒè€…
        EXECUTOR = "executor"  # æ‰§è¡Œè€…
        VALIDATOR = "validator"  # éªŒè¯è€…
        RESEARCHER = "researcher"  # ç ”ç©¶è€…
        CRITIC = "critic"  # è¯„å®¡è€…

    @dataclass
    class Message:
        """Agent é—´é€šä¿¡æ¶ˆæ¯"""

        id: str = field(default_factory=lambda: str(uuid.uuid4()))
        sender: str = ""
        receiver: str = ""  # ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºå¹¿æ’­
        content: Any = None
        msg_type: str = "text"
        metadata: Dict = field(default_factory=dict)

    @dataclass
    class AgentState:
        """Agent çŠ¶æ€"""

        status: str = "idle"  # idle, working, waiting, completed
        current_task: Optional[str] = None
        memory: List[Dict] = field(default_factory=list)
        skills: List[str] = field(default_factory=list)

    class BaseAgent(ABC):
        """Agent åŸºç±»"""

        def __init__(self, name: str, role: AgentRole, description: str = ""):
            self.id = str(uuid.uuid4())
            self.name = name
            self.role = role
            self.description = description
            self.state = AgentState()
            self.inbox: List[Message] = []
            self.outbox: List[Message] = []

        @abstractmethod
        def process(self, input_data: Any) -> Any:
            """å¤„ç†è¾“å…¥æ•°æ®"""
            pass

        @abstractmethod
        def receive_message(self, message: Message):
            """æ¥æ”¶æ¶ˆæ¯"""
            pass

        def send_message(self, receiver: str, content: Any, msg_type: str = "text"):
            """å‘é€æ¶ˆæ¯"""
            message = Message(
                sender=self.name, receiver=receiver, content=content, msg_type=msg_type
            )
            self.outbox.append(message)
            return message

    # æ‰“å°ç±»å®šä¹‰
    print("""
    class AgentRole(Enum):
        COORDINATOR = "coordinator"    # åè°ƒè€…
        EXECUTOR = "executor"          # æ‰§è¡Œè€…
        VALIDATOR = "validator"        # éªŒè¯è€…
        RESEARCHER = "researcher"      # ç ”ç©¶è€…
        CRITIC = "critic"              # è¯„å®¡è€…

    @dataclass
    class Message:
        id: str
        sender: str
        receiver: str
        content: Any
        msg_type: str

    class BaseAgent(ABC):
        def __init__(self, name, role, description):
            self.id = uuid.uuid4()
            self.name = name
            self.role = role
            self.state = AgentState()
            self.inbox = []
            self.outbox = []
    """)


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šå¤š Agent æ¶æ„æ¨¡å¼ ====================


def architecture_patterns():
    """å¤š Agent æ¶æ„æ¨¡å¼"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šå¤š Agent æ¶æ„æ¨¡å¼")
    print("=" * 60)

    print("""
    1. å±‚çº§å¼æ¶æ„ (Hierarchical)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Supervisor â”‚  ä¸»ç®¡ Agent
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
          â–¼       â–¼       â–¼
       â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
       â”‚  A  â”‚ â”‚  B  â”‚ â”‚  C  â”‚  å·¥äºº Agent
       â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
    
    ç‰¹ç‚¹ï¼šæ¸…æ™°çš„å‘½ä»¤é“¾ï¼Œæ˜“äºç®¡ç†
    é€‚ç”¨ï¼šä»»åŠ¡åˆ†è§£æ˜ç¡®çš„åœºæ™¯
    
    2. æ‰å¹³å¼æ¶æ„ (Flat/Peer)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
       â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
       â”‚  A  â”‚â—„â”€â”€â”€â–ºâ”‚  B  â”‚
       â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜
          â”‚    â–²     â”‚
          â–¼    â”‚     â–¼
       â”Œâ”€â”€â”€â”€â”€â”â”€â”´â”€â”€â”Œâ”€â”€â”€â”€â”€â”
       â”‚  D  â”‚â—„â”€â”€â–ºâ”‚  C  â”‚
       â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
    
    ç‰¹ç‚¹ï¼šæ‰€æœ‰ Agent å¹³ç­‰åä½œ
    é€‚ç”¨ï¼šéœ€è¦å¤šè§’åº¦è®¨è®ºçš„åœºæ™¯
    
    3. æµæ°´çº¿å¼æ¶æ„ (Pipeline)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
       â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”
       â”‚  A  â”‚â”€â”€â–ºâ”‚  B  â”‚â”€â”€â–ºâ”‚  C  â”‚
       â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚         â”‚
         â–¼         â–¼         â–¼
      Stage1    Stage2    Stage3
    
    ç‰¹ç‚¹ï¼šé¡ºåºå¤„ç†ï¼Œæ¯ä¸ª Agent å¤„ç†ç‰¹å®šé˜¶æ®µ
    é€‚ç”¨ï¼šå·¥ä½œæµæ˜ç¡®çš„åœºæ™¯
    
    4. æ··åˆå¼æ¶æ„ (Hybrid)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Orchestratorâ”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
          â–¼           â–¼
       â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
       â”‚Team â”‚     â”‚Team â”‚
       â”‚  A  â”‚     â”‚  B  â”‚
       â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜
    
    ç‰¹ç‚¹ï¼šç»“åˆå¤šç§æ¨¡å¼çš„ä¼˜ç‚¹
    é€‚ç”¨ï¼šå¤æ‚çš„ä¼ä¸šçº§åº”ç”¨
    """)


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šç®€å•å¤š Agent æ¼”ç¤º ====================


def simple_multi_agent_demo():
    """ç®€å•å¤š Agent ç³»ç»Ÿæ¼”ç¤º"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šç®€å•å¤š Agent ç³»ç»Ÿæ¼”ç¤º")
    print("=" * 60)

    print("\nğŸ“Œ æ¼”ç¤ºï¼šå†™ä½œ-å®¡æ ¸ä¸¤ Agent åä½œ\n")

    class WriterAgent:
        """å†™ä½œ Agent"""

        def __init__(self):
            self.name = "Writer"

        def write(self, topic: str) -> str:
            """ç”Ÿæˆæ–‡ç« è‰ç¨¿"""
            # æ¨¡æ‹Ÿå†™ä½œè¿‡ç¨‹
            draft = f"""
            ã€å…³äº{topic}çš„æ–‡ç« ã€‘
            
            ç¬¬ä¸€æ®µï¼šä»‹ç»{topic}çš„åŸºæœ¬æ¦‚å¿µ...
            
            ç¬¬äºŒæ®µï¼š{topic}çš„é‡è¦æ€§å’Œåº”ç”¨...
            
            ç¬¬ä¸‰æ®µï¼š{topic}çš„æœªæ¥å‘å±•è¶‹åŠ¿...
            """.strip()
            return draft

        def revise(self, draft: str, feedback: str) -> str:
            """æ ¹æ®åé¦ˆä¿®æ”¹æ–‡ç« """
            # æ¨¡æ‹Ÿä¿®æ”¹è¿‡ç¨‹
            revised = f"{draft}\n\nã€æ ¹æ®åé¦ˆä¿®æ”¹ã€‘\n- å·²æ”¹è¿›ï¼š{feedback}"
            return revised

    class ReviewerAgent:
        """å®¡æ ¸ Agent"""

        def __init__(self):
            self.name = "Reviewer"

        def review(self, content: str) -> dict:
            """å®¡æ ¸æ–‡ç« """
            # æ¨¡æ‹Ÿå®¡æ ¸è¿‡ç¨‹
            issues = []
            suggestions = []

            if len(content) < 200:
                issues.append("æ–‡ç« å†…å®¹è¿‡çŸ­")
                suggestions.append("å»ºè®®å¢åŠ æ›´å¤šç»†èŠ‚å’Œä¾‹å­")

            if "ä¾‹å¦‚" not in content and "ä¾‹å­" not in content:
                issues.append("ç¼ºå°‘å…·ä½“ä¾‹å­")
                suggestions.append("è¯·æ·»åŠ å®é™…æ¡ˆä¾‹")

            return {
                "approved": len(issues) == 0,
                "issues": issues,
                "suggestions": suggestions,
                "score": 7 if issues else 9,
            }

    class SimpleMultiAgentSystem:
        """ç®€å•å¤š Agent ç³»ç»Ÿ"""

        def __init__(self):
            self.writer = WriterAgent()
            self.reviewer = ReviewerAgent()

        def run(self, topic: str, max_iterations: int = 3) -> dict:
            """è¿è¡Œå¤š Agent åä½œæµç¨‹"""
            print(f"ğŸ“‹ ä»»åŠ¡: æ’°å†™å…³äºã€Œ{topic}ã€çš„æ–‡ç« \n")
            print("-" * 40)

            # å†™ä½œé˜¶æ®µ
            print(f"âœï¸  {self.writer.name} æ­£åœ¨å†™ä½œ...")
            draft = self.writer.write(topic)
            print(f"ğŸ“ è‰ç¨¿å®Œæˆ:\n{draft[:100]}...\n")

            # å®¡æ ¸å¾ªç¯
            for i in range(max_iterations):
                print(f"ğŸ” {self.reviewer.name} æ­£åœ¨å®¡æ ¸ (ç¬¬ {i + 1} è½®)...")
                review = self.reviewer.review(draft)

                print(f"   è¯„åˆ†: {review['score']}/10")
                print(f"   é€šè¿‡: {'âœ… æ˜¯' if review['approved'] else 'âŒ å¦'}")

                if review["approved"]:
                    print("âœ… å®¡æ ¸é€šè¿‡ï¼")
                    break

                print(f"   é—®é¢˜: {review['issues']}")
                print(f"   å»ºè®®: {review['suggestions']}")

                # ä¿®æ”¹
                print(f"\nâœï¸  {self.writer.name} æ­£åœ¨ä¿®æ”¹...")
                feedback = "; ".join(review["suggestions"])
                draft = self.writer.revise(draft, feedback)
                print()

            return {
                "topic": topic,
                "final_content": draft,
                "iterations": i + 1,
                "final_review": review,
            }

    # è¿è¡Œæ¼”ç¤º
    print("-" * 40)
    system = SimpleMultiAgentSystem()
    result = system.run("äººå·¥æ™ºèƒ½çš„æœªæ¥")

    print("\n" + "=" * 40)
    print("ğŸ“Š åä½œç»“æœ:")
    print(f"   æ€»è¿­ä»£æ¬¡æ•°: {result['iterations']}")
    print(f"   æœ€ç»ˆè¯„åˆ†: {result['final_review']['score']}/10")


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šåº”ç”¨åœºæ™¯ ====================


def application_scenarios():
    """å¤š Agent åº”ç”¨åœºæ™¯"""
    print("\n" + "=" * 60)
    print("ç¬¬å…­éƒ¨åˆ†ï¼šå¤š Agent åº”ç”¨åœºæ™¯")
    print("=" * 60)

    print("""
    å…¸å‹åº”ç”¨åœºæ™¯
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. è½¯ä»¶å¼€å‘å›¢é˜Ÿ
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   PM    â”‚â”€â”€â–ºâ”‚Developerâ”‚â”€â”€â–ºâ”‚Reviewer â”‚â”€â”€â–ºâ”‚ Tester  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       éœ€æ±‚åˆ†æ      ä»£ç ç¼–å†™       ä»£ç å®¡æŸ¥       æµ‹è¯•éªŒè¯
    
    2. å†…å®¹åˆ›ä½œå›¢é˜Ÿ
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Writer  â”‚â”€â”€â–ºâ”‚ Editor  â”‚â”€â”€â–ºâ”‚ Proofer â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       åˆç¨¿æ’°å†™      å†…å®¹ç¼–è¾‘       æ ¡å¯¹å®¡æ ¸
    
    3. ç ”ç©¶åˆ†æå›¢é˜Ÿ
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚Searcher â”‚â”€â”€â–ºâ”‚Analyzer â”‚â”€â”€â–ºâ”‚Reporter â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       ä¿¡æ¯æ”¶é›†      æ•°æ®åˆ†æ       æŠ¥å‘Šç”Ÿæˆ
    
    4. è¾©è®º/å¤´è„‘é£æš´
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â—„â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚Supporterâ”‚    â”‚ Critic  â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚Moderatorâ”‚  æ€»ç»“åŒæ–¹è§‚ç‚¹
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    5. å®¢æˆ·æœåŠ¡
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚Classifierâ”‚â”€â”€â–ºâ”‚ Handler â”‚â”€â”€â–ºâ”‚ QA Checkâ”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       é—®é¢˜åˆ†ç±»      é—®é¢˜å¤„ç†       è´¨é‡æ£€æŸ¥
    """)


# ==================== ç¬¬ä¸ƒéƒ¨åˆ†ï¼šç»ƒä¹ ä¸æ€è€ƒ ====================


def exercises():
    """ç»ƒä¹ é¢˜"""
    print("\n" + "=" * 60)
    print("ç»ƒä¹ ä¸æ€è€ƒ")
    print("=" * 60)

    print("""
    ç»ƒä¹  1ï¼šæ‰©å±•å†™ä½œç³»ç»Ÿ
        ä¸ºä¸Šé¢çš„å¤š Agent ç³»ç»Ÿæ·»åŠ ä¸€ä¸ª Editor Agentï¼Œ
        è´Ÿè´£åœ¨ Writer å’Œ Reviewer ä¹‹é—´è¿›è¡Œå†…å®¹ä¼˜åŒ–ã€‚

        âœ… å‚è€ƒç­”æ¡ˆï¼š
        ```python
        class EditorAgent(BaseAgent):
            def process(self, content: str) -> str:
                prompt = f'''
                ä½œä¸ºç¼–è¾‘ï¼Œè¯·ä¼˜åŒ–ä»¥ä¸‹å†…å®¹ï¼š
                1. æ”¹å–„è¡¨è¾¾æµç•…åº¦
                2. ä¿®æ­£è¯­æ³•é”™è¯¯
                3. å¢å¼ºé€»è¾‘è¿è´¯æ€§
                
                å†…å®¹ï¼š{content}
                
                ä¼˜åŒ–åçš„å†…å®¹ï¼š
                '''
                return self.llm.invoke(prompt).content

        # ä¿®æ”¹å·¥ä½œæµ
        class WritingSystem:
            def __init__(self):
                self.writer = WriterAgent()
                self.editor = EditorAgent()  # æ–°å¢
                self.reviewer = ReviewerAgent()
            
            def run(self, topic: str) -> dict:
                draft = self.writer.process(topic)
                edited = self.editor.process(draft)  # ç¼–è¾‘ä¼˜åŒ–
                feedback = self.reviewer.process(edited)
                return {"draft": draft, "edited": edited, "feedback": feedback}
        ```
    
    ç»ƒä¹  2ï¼šè®¾è®¡ä¸€ä¸ªè¾©è®ºç³»ç»Ÿ
        åˆ›å»ºä¸¤ä¸ª Agentï¼ˆæ­£æ–¹å’Œåæ–¹ï¼‰å°±æŸä¸ªè¯é¢˜è¿›è¡Œè¾©è®ºï¼Œ
        ç”±ç¬¬ä¸‰ä¸ª Agent ä½œä¸ºè£åˆ¤æ€»ç»“åŒæ–¹è§‚ç‚¹ã€‚

        âœ… å‚è€ƒç­”æ¡ˆï¼š
        ```python
        class DebateSystem:
            def __init__(self, llm):
                self.llm = llm

            def debate(self, topic: str, rounds: int = 3):
                history = []
                
                for i in range(rounds):
                    # æ­£æ–¹å‘è¨€
                    pro_prompt = f"è¯é¢˜ï¼š{topic}\\nå†å²ï¼š{history}\\nä½ æ˜¯æ­£æ–¹ï¼Œè¯·é˜è¿°æ”¯æŒè§‚ç‚¹ï¼š"
                    pro_arg = self.llm.invoke(pro_prompt).content
                    history.append(f"æ­£æ–¹ï¼š{pro_arg}")
                    
                    # åæ–¹å‘è¨€
                    con_prompt = f"è¯é¢˜ï¼š{topic}\\nå†å²ï¼š{history}\\nä½ æ˜¯åæ–¹ï¼Œè¯·åé©³å¹¶é˜è¿°åå¯¹è§‚ç‚¹ï¼š"
                    con_arg = self.llm.invoke(con_prompt).content
                    history.append(f"åæ–¹ï¼š{con_arg}")
                
                # è£åˆ¤æ€»ç»“
                judge_prompt = f"ä½œä¸ºè£åˆ¤ï¼Œè¯·æ€»ç»“å¹¶è¯„åˆ¤ä»¥ä¸‹è¾©è®ºï¼š\\n{history}"
                verdict = self.llm.invoke(judge_prompt).content
                
                return {"debate_history": history, "verdict": verdict}
        ```
    
    ç»ƒä¹  3ï¼šå®ç°æ¶ˆæ¯ä¼ é€’
        ä¸º BaseAgent å®ç°ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ
        è®© Agent ä¹‹é—´å¯ä»¥å¼‚æ­¥é€šä¿¡ã€‚

        âœ… å‚è€ƒç­”æ¡ˆï¼š
        ```python
        from queue import Queue
        from threading import Thread

        class AsyncAgent(BaseAgent):
            def __init__(self, name: str):
                super().__init__(name)
                self.inbox = Queue()
                self.running = False
                
            def send(self, target: 'AsyncAgent', message: dict):
                target.inbox.put({"from": self.name, **message})
            
            def start(self):
                self.running = True
                self.thread = Thread(target=self._process_loop)
                self.thread.start()
            
            def _process_loop(self):
                while self.running:
                    if not self.inbox.empty():
                        message = self.inbox.get()
                        self.handle_message(message)
            
            def handle_message(self, message: dict):
                print(f"{self.name} æ”¶åˆ°æ¶ˆæ¯: {message}")
        ```
    
    æ€è€ƒé¢˜ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€
    1. å¤š Agent ç³»ç»Ÿä¸­å¦‚ä½•é¿å…æ­»é”ï¼Ÿ
       ç­”ï¼šè®¾ç½®è¶…æ—¶æœºåˆ¶ã€å®šä¹‰æ˜ç¡®çš„é€šä¿¡åè®®ã€
       ä½¿ç”¨å¼‚æ­¥é€šä¿¡ã€é¿å…å¾ªç¯ä¾èµ–ã€‚

    2. å¦‚ä½•ç¡®ä¿ Agent ä¹‹é—´çš„ä¿¡æ¯ä¸€è‡´æ€§ï¼Ÿ
       ç­”ï¼šä½¿ç”¨å…±äº«çŠ¶æ€ç®¡ç†ã€è®¾ç½®ç‰ˆæœ¬æ§åˆ¶ã€
       å®ç°äº‹åŠ¡æœºåˆ¶ã€å®šæœŸåŒæ­¥çŠ¶æ€ã€‚

    3. ä½•æ—¶åº”è¯¥å¢åŠ  Agent æ•°é‡ï¼Ÿä½•æ—¶åº”è¯¥å‡å°‘ï¼Ÿ
       ç­”ï¼šä»»åŠ¡å¯ä»¥æ˜ç¡®åˆ†è§£æ—¶å¢åŠ ï¼ŒAgent é—´é€šä¿¡å¼€é”€
       å¤§äºæ”¶ç›Šæ—¶å‡å°‘ã€‚éœ€è¦æƒè¡¡å¤æ‚åº¦å’Œæ•ˆç‡ã€‚
    """)


# ==================== ä¸»å‡½æ•° ====================


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ¤– å¤š Agent ç³»ç»Ÿæ¦‚è¿°")
    print("=" * 60)

    what_is_multi_agent()
    single_vs_multi_agent()
    multi_agent_components()
    architecture_patterns()
    simple_multi_agent_demo()
    application_scenarios()
    exercises()

    print("\n" + "=" * 60)
    print("âœ… è¯¾ç¨‹å®Œæˆï¼ä¸‹ä¸€æ­¥ï¼š02-langgraph-basics.py")
    print("=" * 60)


if __name__ == "__main__":
    main()
