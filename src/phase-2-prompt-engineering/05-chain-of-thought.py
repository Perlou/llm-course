"""
æ€ç»´é“¾æç¤º (Chain of Thought)
=============================

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£æ€ç»´é“¾æç¤ºçš„åŸç†
    2. æŒæ¡ CoT æç¤ºè¯è®¾è®¡
    3. å­¦ä¼šå¼•å¯¼æ¨¡å‹é€æ­¥æ¨ç†

æ ¸å¿ƒæ¦‚å¿µï¼š
    - CoTï¼šè®©æ¨¡å‹å±•ç¤ºæ¨ç†è¿‡ç¨‹
    - é€æ­¥æ€è€ƒï¼šåˆ†è§£é—®é¢˜ä¸ºå°æ­¥éª¤
    - æ¨ç†è½¨è¿¹ï¼šå¯è¿½æº¯çš„æ€è€ƒè¿‡ç¨‹

å‰ç½®çŸ¥è¯†ï¼š
    - 04-few-shot-learning.py

ç¯å¢ƒè¦æ±‚ï¼š
    - pip install openai python-dotenv
"""

import os
from dotenv import load_dotenv
from openai import OpenAI

load_dotenv()


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šCoT æ¦‚å¿µ ====================


def cot_concept():
    """CoT æ¦‚å¿µ"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šæ€ç»´é“¾ (CoT) æ¦‚å¿µ")
    print("=" * 60)

    print("""
    æ€ç»´é“¾æç¤º (Chain of Thought)ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    è®©æ¨¡å‹åœ¨ç»™å‡ºç­”æ¡ˆå‰ï¼Œå…ˆå±•ç¤ºæ¨ç†è¿‡ç¨‹ã€‚
    
    ä¼ ç»Ÿæ–¹å¼ï¼š
    é—®ï¼šå°æ˜æœ‰5ä¸ªè‹¹æœï¼Œåƒäº†2ä¸ªï¼Œåˆä¹°äº†3ä¸ªï¼Œç°åœ¨æœ‰å‡ ä¸ªï¼Ÿ
    ç­”ï¼š6ä¸ª
    
    CoTæ–¹å¼ï¼š
    é—®ï¼š...è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒ...
    ç­”ï¼š1) å°æ˜æœ€åˆæœ‰5ä¸ªè‹¹æœ
        2) åƒäº†2ä¸ªï¼Œå‰©ä¸‹5-2=3ä¸ª
        3) åˆä¹°äº†3ä¸ªï¼Œ3+3=6ä¸ª
        4) æ‰€ä»¥ç°åœ¨æœ‰6ä¸ªè‹¹æœ
    
    ä¼˜åŠ¿ï¼š
    - æé«˜å¤æ‚æ¨ç†å‡†ç¡®æ€§
    - ä¾¿äºéªŒè¯å’Œè°ƒè¯•
    - å‡å°‘"è·³è·ƒå¼"é”™è¯¯
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šZero-Shot CoT ====================


def zero_shot_cot():
    """Zero-Shot CoT"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šZero-Shot CoT")
    print("=" * 60)

    client = OpenAI()

    problem = "ä¸€ä¸ªæ°´æ± æœ‰ä¸¤ä¸ªè¿›æ°´ç®¡å’Œä¸€ä¸ªå‡ºæ°´ç®¡ã€‚è¿›æ°´ç®¡Aæ¯å°æ—¶è¿›æ°´10å‡ï¼Œè¿›æ°´ç®¡Bæ¯å°æ—¶è¿›æ°´15å‡ï¼Œå‡ºæ°´ç®¡æ¯å°æ—¶æ”¾æ°´8å‡ã€‚å¦‚æœæ°´æ± åˆå§‹æœ‰100å‡æ°´ï¼Œ2å°æ—¶åæ°´æ± æœ‰å¤šå°‘å‡æ°´ï¼Ÿ"

    # æ—  CoT
    print("ğŸ“Œ æ—  CoTï¼š")
    r1 = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": problem}],
        max_tokens=100,
    )
    print(f"å›å¤: {r1.choices[0].message.content}")

    # Zero-Shot CoT
    # print("\nğŸ“Œ Zero-Shot CoTï¼ˆæ·»åŠ è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒ"ï¼‰ï¼š")
    cot_prompt = problem + "\n\nè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒï¼š"
    r2 = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": cot_prompt}],
        max_tokens=300,
    )
    print(f"å›å¤:\n{r2.choices[0].message.content}")


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šFew-Shot CoT ====================


def few_shot_cot():
    """Few-Shot CoT"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šFew-Shot CoT")
    print("=" * 60)

    client = OpenAI()

    few_shot_prompt = """è§£å†³æ•°å­¦é—®é¢˜ï¼Œå±•ç¤ºæ€è€ƒè¿‡ç¨‹ã€‚

é—®é¢˜ï¼šå°æ˜æœ‰8ä¸ªè‹¹æœï¼Œç»™äº†å°çº¢3ä¸ªï¼Œåˆä»å°æé‚£è·å¾—5ä¸ªï¼Œç°åœ¨æœ‰å‡ ä¸ªï¼Ÿ
æ€è€ƒè¿‡ç¨‹ï¼š
1. å°æ˜æœ€åˆæœ‰8ä¸ªè‹¹æœ
2. ç»™äº†å°çº¢3ä¸ªåï¼š8-3=5ä¸ª
3. ä»å°æè·å¾—5ä¸ªåï¼š5+5=10ä¸ª
ç­”æ¡ˆï¼š10ä¸ª

é—®é¢˜ï¼šä¸€ä¸ªç­æœ‰40ä¸ªå­¦ç”Ÿï¼Œç”·ç”Ÿæ¯”å¥³ç”Ÿå¤š8äººï¼Œç”·ç”Ÿæœ‰å¤šå°‘äººï¼Ÿ
æ€è€ƒè¿‡ç¨‹ï¼š
1. è®¾å¥³ç”Ÿæœ‰xäººï¼Œåˆ™ç”·ç”Ÿæœ‰x+8äºº
2. æ€»äººæ•°ï¼šx+(x+8)=40
3. è§£æ–¹ç¨‹ï¼š2x+8=40ï¼Œ2x=32ï¼Œx=16
4. ç”·ç”Ÿäººæ•°ï¼š16+8=24äºº
ç­”æ¡ˆï¼š24äºº

é—®é¢˜ï¼šç«è½¦ä»Aç«™åˆ°Bç«™éœ€è¦3å°æ—¶ï¼Œé€Ÿåº¦æ˜¯80å…¬é‡Œ/å°æ—¶ã€‚å¦‚æœé€Ÿåº¦æé«˜åˆ°100å…¬é‡Œ/å°æ—¶ï¼Œéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
æ€è€ƒè¿‡ç¨‹ï¼š"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": few_shot_prompt}],
        max_tokens=200,
    )
    print(f"å›å¤:\n{response.choices[0].message.content}")


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šä»£ç é—®é¢˜ CoT ====================


def code_cot():
    """ä»£ç é—®é¢˜ CoT"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šä»£ç é—®é¢˜ CoT")
    print("=" * 60)

    client = OpenAI()

    code_prompt = """åˆ†æè¿™æ®µä»£ç çš„é—®é¢˜ï¼Œé€æ­¥æ€è€ƒï¼š

```python
def find_max(numbers):
    max_num = 0
    for num in numbers:
        if num > max_num:
            max_num = num
    return max_num

result = find_max([-5, -2, -8, -1])
print(result)  # è¾“å‡ºï¼š0
```

è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š
1. é¦–å…ˆç†è§£ä»£ç çš„é¢„æœŸåŠŸèƒ½
2. ç„¶åè¿½è¸ªä»£ç æ‰§è¡Œè¿‡ç¨‹
3. æ‰¾å‡ºé—®é¢˜æ‰€åœ¨
4. ç»™å‡ºä¿®å¤å»ºè®®"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": code_prompt}],
        max_tokens=400,
    )
    print(f"å›å¤:\n{response.choices[0].message.content}")


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šCoT ä½¿ç”¨æŠ€å·§ ====================


def cot_tips():
    """CoT ä½¿ç”¨æŠ€å·§"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šCoT ä½¿ç”¨æŠ€å·§")
    print("=" * 60)

    print("""
    ä½•æ—¶ä½¿ç”¨ CoTï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ… æ•°å­¦è®¡ç®—å’Œæ¨ç†
    âœ… é€»è¾‘é—®é¢˜
    âœ… ä»£ç è°ƒè¯•
    âœ… å¤šæ­¥éª¤å†³ç­–
    âŒ ç®€å•äº‹å®æŸ¥è¯¢
    âŒ åˆ›æ„å†™ä½œ
    
    å¸¸ç”¨è§¦å‘çŸ­è¯­ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - "è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒ"
    - "è¯·å±•ç¤ºæ¨ç†è¿‡ç¨‹"
    - "é€æ­¥åˆ†æè¿™ä¸ªé—®é¢˜"
    - "è¯¦ç»†è§£é‡Šä½ çš„æ€è€ƒ"
    - "Think step by step"
    
    ä¼˜åŒ–æŠ€å·§ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€
    1. æ˜ç¡®è¦æ±‚å±•ç¤ºæ­¥éª¤
    2. æä¾›æ¨ç†ç¤ºä¾‹
    3. è¦æ±‚æœ€åç»™å‡ºç»“è®º
    4. å¤æ‚é—®é¢˜å…ˆåˆ†è§£
    """)


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šç»ƒä¹ ä¸æ€è€ƒ ====================


def exercises():
    """ç»ƒä¹ é¢˜"""
    print("\n" + "=" * 60)
    print("ç»ƒä¹ ä¸æ€è€ƒ")
    print("=" * 60)

    print("""
    ç»ƒä¹  1ï¼šæ•°å­¦åº”ç”¨é¢˜
        ç”¨ CoT è§£å†³ä¸€ä¸ªå¹´é¾„é—®é¢˜ã€‚

    ç»ƒä¹  2ï¼šé€»è¾‘æ¨ç†
        ç”¨ CoT è§£å†³ä¸€ä¸ªæ’åˆ—ç»„åˆé—®é¢˜ã€‚

    ç»ƒä¹  3ï¼šä»£ç è°ƒè¯•
        ç”¨ CoT åˆ†æä¸€æ®µæœ‰ bug çš„ä»£ç ã€‚

    æ€è€ƒé¢˜ï¼š
        1. CoT ä¼šå¢åŠ  token æ¶ˆè€—å—ï¼Ÿ
        2. ä»€ä¹ˆæƒ…å†µä¸‹ CoT åè€Œä¼šé™ä½å‡†ç¡®æ€§ï¼Ÿ
    """)


# ==================== ä¸»å‡½æ•° ====================


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ æ€ç»´é“¾æç¤º (Chain of Thought)")
    print("=" * 60)

    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("âŒ é”™è¯¯ï¼šæœªè®¾ç½® OPENAI_API_KEY")
        return

    try:
        cot_concept()
        zero_shot_cot()
        few_shot_cot()
        code_cot()
        cot_tips()
        exercises()
    except Exception as e:
        print(f"\nâŒ å‘ç”Ÿé”™è¯¯: {e}")
        return

    print("\n" + "=" * 60)
    print("âœ… è¯¾ç¨‹å®Œæˆï¼ä¸‹ä¸€æ­¥ï¼š06-self-consistency.py")
    print("=" * 60)


if __name__ == "__main__":
    main()
