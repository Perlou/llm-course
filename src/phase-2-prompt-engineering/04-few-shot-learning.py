"""
å°‘æ ·æœ¬å­¦ä¹  (Few-Shot Learning)
==============================

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£å°‘æ ·æœ¬å­¦ä¹ çš„åŸç†
    2. æŒæ¡ Few-Shot æç¤ºè¯è®¾è®¡
    3. å­¦ä¼šé€‰æ‹©å’Œç»„ç»‡ç¤ºä¾‹

æ ¸å¿ƒæ¦‚å¿µï¼š
    - Zero-Shotï¼šæ— ç¤ºä¾‹ç›´æ¥æé—®
    - One-Shotï¼šæä¾›ä¸€ä¸ªç¤ºä¾‹
    - Few-Shotï¼šæä¾›å¤šä¸ªç¤ºä¾‹

å‰ç½®çŸ¥è¯†ï¼š
    - 03-instruction-tuning.py

ç¯å¢ƒè¦æ±‚ï¼š
    - pip install openai python-dotenv
"""

import os
from dotenv import load_dotenv
from openai import OpenAI

load_dotenv()


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šFew-Shot æ¦‚å¿µ ====================


def few_shot_concept():
    """Few-Shot æ¦‚å¿µ"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šFew-Shot æ¦‚å¿µ")
    print("=" * 60)

    print("""
    Few-Shot Learningï¼ˆå°‘æ ·æœ¬å­¦ä¹ ï¼‰ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    é€šè¿‡åœ¨æç¤ºè¯ä¸­æä¾›å°‘é‡ç¤ºä¾‹ï¼Œè®©æ¨¡å‹å­¦ä¹ ä»»åŠ¡æ¨¡å¼ã€‚
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Zero-Shot    â”‚  æ— ç¤ºä¾‹ï¼Œç›´æ¥é—®é—®é¢˜          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  One-Shot     â”‚  æä¾› 1 ä¸ªç¤ºä¾‹              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Few-Shot     â”‚  æä¾› 2-5 ä¸ªç¤ºä¾‹            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ç¤ºä¾‹æ•ˆæœï¼š
    - å¸®åŠ©æ¨¡å‹ç†è§£ä»»åŠ¡æ ¼å¼
    - æä¾›è¾“å‡ºçš„å‚ç…§æ ‡å‡†
    - å‡å°‘æ­§ä¹‰å’Œè¯¯è§£
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šZero-Shot vs Few-Shot ====================


def zero_vs_few_shot():
    """Zero-Shot vs Few-Shot å¯¹æ¯”"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šZero-Shot vs Few-Shot å¯¹æ¯”")
    print("=" * 60)

    client = OpenAI()

    # Zero-Shot
    print("ğŸ“Œ Zero-Shotï¼ˆæ— ç¤ºä¾‹ï¼‰ï¼š")
    zero_prompt = "åˆ¤æ–­è¿™å¥è¯çš„æƒ…æ„Ÿæ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢ï¼šä»Šå¤©å¤©æ°”çœŸç³Ÿç³•"
    r1 = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": zero_prompt}],
        max_tokens=50,
    )
    print(f"å›å¤: {r1.choices[0].message.content}")

    # Few-Shot
    print("\nğŸ“Œ Few-Shotï¼ˆæœ‰ç¤ºä¾‹ï¼‰ï¼š")
    few_shot_prompt = """åˆ¤æ–­å¥å­çš„æƒ…æ„Ÿå€¾å‘ã€‚

ç¤ºä¾‹ï¼š
å¥å­ï¼šè¿™ä¸ªäº§å“å¤ªæ£’äº†ï¼
æƒ…æ„Ÿï¼šæ­£é¢

å¥å­ï¼šæœåŠ¡æ€åº¦å¾ˆå·®
æƒ…æ„Ÿï¼šè´Ÿé¢

å¥å­ï¼šä»·æ ¼è¿˜å¯ä»¥
æƒ…æ„Ÿï¼šä¸­æ€§

å¥å­ï¼šä»Šå¤©å¤©æ°”çœŸç³Ÿç³•
æƒ…æ„Ÿï¼š"""

    r2 = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": few_shot_prompt}],
        max_tokens=20,
    )
    print(f"å›å¤: {r2.choices[0].message.content}")


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šåˆ†ç±»ä»»åŠ¡ ====================


def classification_task():
    """åˆ†ç±»ä»»åŠ¡æ¼”ç¤º"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šåˆ†ç±»ä»»åŠ¡")
    print("=" * 60)

    client = OpenAI()

    classify_prompt = """å°†å®¢æˆ·åé¦ˆåˆ†ç±»ä¸ºä»¥ä¸‹ç±»åˆ«ä¹‹ä¸€ï¼šäº§å“é—®é¢˜ã€ç‰©æµé—®é¢˜ã€æœåŠ¡é—®é¢˜ã€å…¶ä»–

ç¤ºä¾‹ï¼š
åé¦ˆï¼šæ‰‹æœºå±å¹•æœ‰åˆ’ç—•
åˆ†ç±»ï¼šäº§å“é—®é¢˜

åé¦ˆï¼šå¿«é€’å‘˜æ€åº¦å¾ˆå·®
åˆ†ç±»ï¼šç‰©æµé—®é¢˜

åé¦ˆï¼šå®¢æœç”µè¯ä¸€ç›´æ‰“ä¸é€š
åˆ†ç±»ï¼šæœåŠ¡é—®é¢˜

åé¦ˆï¼šåŒ…è£…å‘è´§å¾ˆæ…¢ï¼Œç­‰äº†ä¸€å‘¨æ‰åˆ°
åˆ†ç±»ï¼š"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": classify_prompt}],
        max_tokens=20,
    )
    print(f"åˆ†ç±»ç»“æœ: {response.choices[0].message.content}")


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šæ ¼å¼è½¬æ¢ ====================


def format_conversion():
    """æ ¼å¼è½¬æ¢ä»»åŠ¡"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šæ ¼å¼è½¬æ¢")
    print("=" * 60)

    client = OpenAI()

    format_prompt = """å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º SQL æŸ¥è¯¢ã€‚

ç¤ºä¾‹ï¼š
é—®é¢˜ï¼šæŸ¥æ‰¾æ‰€æœ‰å¹´é¾„å¤§äº30çš„ç”¨æˆ·
SQLï¼šSELECT * FROM users WHERE age > 30

é—®é¢˜ï¼šç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„ç”¨æˆ·æ•°é‡
SQLï¼šSELECT city, COUNT(*) FROM users GROUP BY city

é—®é¢˜ï¼šæ‰¾å‡ºè´­ä¹°é‡‘é¢æœ€é«˜çš„å‰10ä¸ªè®¢å•
SQLï¼š"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": format_prompt}],
        max_tokens=50,
    )
    print(f"SQL: {response.choices[0].message.content}")


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šç¤ºä¾‹é€‰æ‹©æŠ€å·§ ====================


def example_selection():
    """ç¤ºä¾‹é€‰æ‹©æŠ€å·§"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šç¤ºä¾‹é€‰æ‹©æŠ€å·§")
    print("=" * 60)

    print("""
    é€‰æ‹©å¥½ç¤ºä¾‹çš„åŸåˆ™ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. ä»£è¡¨æ€§ï¼šè¦†ç›–å¸¸è§æƒ…å†µ
    2. å¤šæ ·æ€§ï¼šæ¶µç›–ä¸åŒç±»åˆ«
    3. æ¸…æ™°æ€§ï¼šé¿å…æ­§ä¹‰æ¡ˆä¾‹
    4. ç›¸å…³æ€§ï¼šä¸ç›®æ ‡ä»»åŠ¡ç›¸ä¼¼
    5. æ•°é‡é€‚ä¸­ï¼šé€šå¸¸ 2-5 ä¸ª
    
    ç¤ºä¾‹æ’åˆ—é¡ºåºï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    - ç®€å•åˆ°å¤æ‚
    - å¸¸è§åˆ°ç½•è§
    - æœ€ç›¸å…³çš„æ”¾æœ€åï¼ˆrecency biasï¼‰
    """)


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šç»ƒä¹ ä¸æ€è€ƒ ====================


def exercises():
    """ç»ƒä¹ é¢˜"""
    print("\n" + "=" * 60)
    print("ç»ƒä¹ ä¸æ€è€ƒ")
    print("=" * 60)

    print("""
    ç»ƒä¹  1ï¼šæƒ…æ„Ÿåˆ†æ
        è®¾è®¡ä¸€ä¸ª 3-shot çš„æƒ…æ„Ÿåˆ†ææç¤ºè¯ã€‚

    ç»ƒä¹  2ï¼šå®ä½“æå–
        ç”¨ Few-Shot ä»æ–°é—»ä¸­æå–äººåã€åœ°ç‚¹ã€æ—¶é—´ã€‚

    ç»ƒä¹  3ï¼šé£æ ¼è½¬æ¢
        ç”¨ Few-Shot å°†æ­£å¼æ–‡æœ¬è½¬æ¢ä¸ºå£è¯­åŒ–è¡¨è¾¾ã€‚

    æ€è€ƒé¢˜ï¼š
        1. ç¤ºä¾‹æ•°é‡è¶Šå¤šè¶Šå¥½å—ï¼Ÿ
        2. é”™è¯¯ç¤ºä¾‹ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Ÿ
        3. å¦‚ä½•å¤„ç†è¾¹ç•Œæƒ…å†µï¼Ÿ
    """)


# ==================== ä¸»å‡½æ•° ====================


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ å°‘æ ·æœ¬å­¦ä¹  (Few-Shot Learning)")
    print("=" * 60)

    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("âŒ é”™è¯¯ï¼šæœªè®¾ç½® OPENAI_API_KEY")
        return

    try:
        few_shot_concept()
        zero_vs_few_shot()
        classification_task()
        format_conversion()
        example_selection()
        exercises()
    except Exception as e:
        print(f"\nâŒ å‘ç”Ÿé”™è¯¯: {e}")
        return

    print("\n" + "=" * 60)
    print("âœ… è¯¾ç¨‹å®Œæˆï¼ä¸‹ä¸€æ­¥ï¼š05-chain-of-thought.py")
    print("=" * 60)


if __name__ == "__main__":
    main()
