# Phase 6: Agent ä¸å·¥å…·è°ƒç”¨ - æ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ

> **å­¦ä¹ ç›®æ ‡**ï¼šæ·±å…¥ç†è§£ Agent æ¶æ„ã€å·¥å…·è°ƒç”¨æœºåˆ¶ä»¥åŠ MCP åè®®

---

## ç›®å½•

1. [å¼•è¨€ï¼šä»€ä¹ˆæ˜¯ Agentï¼Ÿ](#1-å¼•è¨€ä»€ä¹ˆæ˜¯-agent)
2. [Agent æ ¸å¿ƒæ¶æ„](#2-agent-æ ¸å¿ƒæ¶æ„)
3. [å·¥å…·è°ƒç”¨æœºåˆ¶ (Tool Calling)](#3-å·¥å…·è°ƒç”¨æœºåˆ¶-tool-calling)
4. [ReAct æ¨¡å¼ï¼šæ¨ç†ä¸è¡ŒåŠ¨](#4-react-æ¨¡å¼æ¨ç†ä¸è¡ŒåŠ¨)
5. [MCP åè®®è¯¦è§£](#5-mcp-åè®®è¯¦è§£)
6. [å®æˆ˜ï¼šæ„å»ºå®Œæ•´ Agent](#6-å®æˆ˜æ„å»ºå®Œæ•´-agent)
7. [æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±](#7-æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±)
8. [æ€»ç»“](#8-æ€»ç»“)

---

## 1. å¼•è¨€ï¼šä»€ä¹ˆæ˜¯ Agentï¼Ÿ

### 1.1 Agent çš„å®šä¹‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»€ä¹ˆæ˜¯ Agentï¼Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Agent = LLM + è®°å¿† + å·¥å…· + è§„åˆ’èƒ½åŠ›                           â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   LLM   â”‚ +  â”‚  Memory â”‚ +  â”‚  Tools  â”‚ +  â”‚Planning â”‚     â”‚
â”‚   â”‚  å¤§è„‘   â”‚    â”‚  è®°å¿†   â”‚    â”‚  å·¥å…·   â”‚    â”‚  è§„åˆ’   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   Agent æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–ã€æ‰§è¡Œè¡ŒåŠ¨çš„æ™ºèƒ½ç³»ç»Ÿ       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Agentï¼ˆæ™ºèƒ½ä½“ï¼‰** æ˜¯ä¸€ä¸ªä»¥å¤§è¯­è¨€æ¨¡å‹ä¸ºæ ¸å¿ƒçš„è‡ªä¸»ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿï¼š

- ğŸ§  **ç†è§£**ç”¨æˆ·æ„å›¾å’Œä¸Šä¸‹æ–‡
- ğŸ¤” **è§„åˆ’**å®Œæˆä»»åŠ¡çš„æ­¥éª¤
- ğŸ”§ **ä½¿ç”¨**å¤–éƒ¨å·¥å…·æ‰©å±•èƒ½åŠ›
- ğŸ”„ **è¿­ä»£**ä¼˜åŒ–ç›´åˆ°ä»»åŠ¡å®Œæˆ

### 1.2 ä¼ ç»Ÿ LLM vs Agent

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼ ç»Ÿ LLM vs Agent å¯¹æ¯”                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      ä¼ ç»Ÿ LLM        â”‚                 Agent                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                                             â”‚
â”‚  ç”¨æˆ· â”€â”€â†’ LLM â”€â”€â†’ å›å¤  â”‚  ç”¨æˆ· â”€â”€â†’ Agent â”€â”€â†’ æ€è€ƒ â”€â”€â†’ è¡ŒåŠ¨ â”€â”€â†’ è§‚å¯Ÿ  â”‚
â”‚                      â”‚              â†‘                    â”‚         â”‚
â”‚   â€¢ å•è½®å¯¹è¯          â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚   â€¢ é™æ€çŸ¥è¯†          â”‚                                             â”‚
â”‚   â€¢ æ— æ³•æ‰§è¡Œæ“ä½œ       â”‚   â€¢ å¤šè½®æ¨ç†å¾ªç¯                            â”‚
â”‚   â€¢ è¢«åŠ¨å“åº”          â”‚   â€¢ åŠ¨æ€è·å–ä¿¡æ¯                             â”‚
â”‚                      â”‚   â€¢ å¯æ‰§è¡ŒçœŸå®æ“ä½œ                           â”‚
â”‚                      â”‚   â€¢ ä¸»åŠ¨å®Œæˆä»»åŠ¡                             â”‚
â”‚                      â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ Agentï¼Ÿ

```python
# ä¼ ç»Ÿ LLM çš„å±€é™æ€§ç¤ºä¾‹
user_question = "ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"

# âŒ ä¼ ç»Ÿ LLM åªèƒ½åŸºäºè®­ç»ƒæ•°æ®å›ç­”
traditional_response = "æˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼Œæˆ‘çš„çŸ¥è¯†æˆªæ­¢äº..."

# âœ… Agent å¯ä»¥è°ƒç”¨å·¥å…·è·å–å®æ—¶ä¿¡æ¯
agent_response = """
è®©æˆ‘æŸ¥è¯¢ä¸€ä¸‹åŒ—äº¬çš„å®æ—¶å¤©æ°”...
[è°ƒç”¨å¤©æ°”API]
æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œä»Šå¤©åŒ—äº¬å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©25Â°Cï¼Œé€‚åˆå¤–å‡ºã€‚
"""
```

**Agent è§£å†³äº† LLM çš„æ ¸å¿ƒå±€é™**ï¼š

| å±€é™æ€§       | Agent è§£å†³æ–¹æ¡ˆ           |
| ------------ | ------------------------ |
| çŸ¥è¯†è¿‡æ—¶     | é€šè¿‡æœç´¢å·¥å…·è·å–æœ€æ–°ä¿¡æ¯ |
| æ— æ³•è®¡ç®—     | è°ƒç”¨è®¡ç®—å™¨/ä»£ç æ‰§è¡Œå™¨    |
| æ— æ³•æ“ä½œ     | é›†æˆ API æ‰§è¡ŒçœŸå®æ“ä½œ    |
| ç¼ºä¹ä¸“ä¸šçŸ¥è¯† | æ¥å…¥çŸ¥è¯†åº“å’Œä¸“ä¸šå·¥å…·     |

---

## 2. Agent æ ¸å¿ƒæ¶æ„

### 2.1 åŸºæœ¬æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent æ ¸å¿ƒæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                        â”‚   ç”¨æˆ·è¾“å…¥     â”‚                            â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                â”‚                                    â”‚
â”‚                                â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Agent æ ¸å¿ƒå±‚                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚                    LLM (å¤§è„‘)                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ ç†è§£è¾“å…¥    â€¢ æ¨ç†å†³ç­–    â€¢ ç”Ÿæˆè¾“å‡º                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                             â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â–¼          â–¼          â–¼          â–¼           â”‚              â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚              â”‚  â”‚
â”‚  â”‚ â”‚è®°å¿†â”‚   â”‚è§„åˆ’ â”‚   â”‚ å·¥å…· â”‚   â”‚ åæ€ â”‚       â”‚              â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚  â”‚
â”‚  â”‚   â”‚         â”‚          â”‚          â”‚          â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚         â”‚          â”‚          â”‚          â”‚                  â”‚
â”‚      â–¼         â–¼          â–¼          â–¼          â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚çŸ­æœŸ  â”‚ â”‚ä»»åŠ¡   â”‚ â”‚ å¤–éƒ¨API  â”‚ â”‚ç»“æœ   â”‚ â”‚ è¾“å‡º   â”‚             â”‚
â”‚  â”‚é•¿æœŸ  â”‚ â”‚åˆ†è§£   â”‚ â”‚ æ•°æ®åº“   â”‚ â”‚è¯„ä¼°   â”‚ â”‚ å“åº”   â”‚             â”‚
â”‚  â”‚è®°å¿†  â”‚ â”‚       â”‚ â”‚ æ–‡ä»¶ç³»ç»Ÿ â”‚ â”‚       â”‚ â”‚        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶è¯¦è§£

#### 2.2.1 LLMï¼ˆå¤§è„‘ï¼‰

```python
class AgentBrain:
    """Agent çš„å¤§è„‘ - LLM"""

    def __init__(self, model: str = "gpt-4"):
        self.model = model
        self.system_prompt = """
        ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚
        åœ¨å›ç­”é—®é¢˜æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š
        1. åˆ†æç”¨æˆ·éœ€æ±‚
        2. å†³å®šæ˜¯å¦éœ€è¦ä½¿ç”¨å·¥å…·
        3. å¦‚éœ€ä½¿ç”¨å·¥å…·ï¼Œè°ƒç”¨é€‚å½“çš„å·¥å…·
        4. åŸºäºå·¥å…·è¿”å›ç»“æœï¼Œç»™å‡ºæœ€ç»ˆç­”æ¡ˆ
        """

    def think(self, input: str, context: dict) -> dict:
        """æ€è€ƒå¹¶å†³ç­–ä¸‹ä¸€æ­¥è¡ŒåŠ¨"""
        # è°ƒç”¨ LLM è¿›è¡Œæ¨ç†
        response = self.call_llm(input, context)
        return self.parse_response(response)
```

#### 2.2.2 è®°å¿†ç³»ç»Ÿ

```python
class MemorySystem:
    """Agent çš„è®°å¿†ç³»ç»Ÿ"""

    def __init__(self):
        # çŸ­æœŸè®°å¿†ï¼šå½“å‰å¯¹è¯ä¸Šä¸‹æ–‡
        self.short_term: List[Message] = []

        # é•¿æœŸè®°å¿†ï¼šæŒä¹…åŒ–å­˜å‚¨
        self.long_term: VectorStore = VectorStore()

        # å·¥ä½œè®°å¿†ï¼šå½“å‰ä»»åŠ¡çŠ¶æ€
        self.working: Dict[str, Any] = {}

    def add_to_short_term(self, message: Message):
        """æ·»åŠ åˆ°çŸ­æœŸè®°å¿†"""
        self.short_term.append(message)
        # ä¿æŒçª—å£å¤§å°
        if len(self.short_term) > self.max_size:
            self.compress_and_store()

    def recall(self, query: str) -> List[str]:
        """ä»é•¿æœŸè®°å¿†ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯"""
        return self.long_term.search(query, top_k=5)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è®°å¿†ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    çŸ­æœŸè®°å¿†                              â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚   â”‚   â”‚ M1  â”‚â†’â”‚ M2  â”‚â†’â”‚ M3  â”‚â†’â”‚ M4  â”‚â†’â”‚ M5  â”‚  (å¯¹è¯å†å²)   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚ å‹ç¼©/æ€»ç»“                        â”‚
â”‚                              â–¼                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    é•¿æœŸè®°å¿†                              â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚              å‘é‡æ•°æ®åº“                          â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   [çŸ¥è¯†ç‰‡æ®µ] [å†å²æ€»ç»“] [å­¦ä¹ ç»éªŒ] [ç”¨æˆ·åå¥½]    â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 è§„åˆ’æ¨¡å—

```python
class PlanningModule:
    """ä»»åŠ¡è§„åˆ’æ¨¡å—"""

    def decompose_task(self, complex_task: str) -> List[SubTask]:
        """å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡"""
        prompt = f"""
        è¯·å°†ä»¥ä¸‹ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„å­ä»»åŠ¡ï¼š
        ä»»åŠ¡ï¼š{complex_task}

        è¾“å‡ºæ ¼å¼ï¼š
        1. [å­ä»»åŠ¡1]
        2. [å­ä»»åŠ¡2]
        ...
        """
        # è°ƒç”¨ LLM è¿›è¡Œä»»åŠ¡åˆ†è§£
        return self.llm.generate(prompt)

    def create_plan(self, goal: str, available_tools: List[Tool]) -> Plan:
        """åˆ›å»ºæ‰§è¡Œè®¡åˆ’"""
        return Plan(
            goal=goal,
            steps=self.decompose_task(goal),
            tools=self.select_tools(available_tools)
        )
```

### 2.3 Agent æ‰§è¡Œå¾ªç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent æ‰§è¡Œå¾ªç¯ (Agent Loop)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚                                          â”‚              â”‚
â”‚           â–¼                                          â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚              â”‚
â”‚    â”‚   æ„ŸçŸ¥      â”‚  â† æ¥æ”¶ç”¨æˆ·è¾“å…¥/ç¯å¢ƒåé¦ˆ           â”‚              â”‚
â”‚    â”‚  Perceive   â”‚                                   â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚              â”‚
â”‚           â”‚                                          â”‚              â”‚
â”‚           â–¼                                          â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚              â”‚
â”‚    â”‚   æ€è€ƒ      â”‚  â† LLM æ¨ç†ã€è§„åˆ’                  â”‚              â”‚
â”‚    â”‚   Think     â”‚                                   â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚              â”‚
â”‚           â”‚                                          â”‚              â”‚
â”‚           â–¼                                          â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”‚
â”‚    â”‚   å†³ç­–      â”‚â”€â”€æ˜¯â”€â”€â”‚  éœ€è¦å·¥å…·ï¼Ÿ  â”‚              â”‚              â”‚
â”‚    â”‚  Decide     â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚å¦                   â”‚              â”‚
â”‚           â”‚                    â–¼                     â”‚              â”‚
â”‚           â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”‚
â”‚           â”‚             â”‚  ç›´æ¥å›å¤   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚           â–¼             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚              â”‚
â”‚    â”‚   æ‰§è¡Œ      â”‚  â† è°ƒç”¨å·¥å…·/æ‰§è¡Œæ“ä½œ               â”‚              â”‚
â”‚    â”‚    Act      â”‚                                   â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚              â”‚
â”‚           â”‚                                          â”‚              â”‚
â”‚           â–¼                                          â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”‚
â”‚    â”‚   è§‚å¯Ÿ      â”‚â”€â”€å¦â”€â”€â”‚  ä»»åŠ¡å®Œæˆï¼Ÿ  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚    â”‚  Observe    â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚æ˜¯                                  â”‚
â”‚                                â–¼                                    â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                         â”‚  è¿”å›ç»“æœ   â”‚                             â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
class AgentLoop:
    """Agent æ ¸å¿ƒæ‰§è¡Œå¾ªç¯"""

    def run(self, user_input: str) -> str:
        """æ‰§è¡Œ Agent å¾ªç¯"""

        # åˆå§‹åŒ–
        self.memory.add_message("user", user_input)
        iteration = 0
        max_iterations = 10

        while iteration < max_iterations:
            iteration += 1

            # 1. æ€è€ƒï¼šLLM å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
            thought = self.think()

            # 2. æ£€æŸ¥æ˜¯å¦éœ€è¦å·¥å…·
            if thought.action_type == "final_answer":
                return thought.content

            # 3. æ‰§è¡Œå·¥å…·è°ƒç”¨
            if thought.action_type == "tool_call":
                tool_name = thought.tool_name
                tool_args = thought.tool_args

                # æ‰§è¡Œå·¥å…·
                observation = self.execute_tool(tool_name, tool_args)

                # 4. å°†è§‚å¯Ÿç»“æœåŠ å…¥ä¸Šä¸‹æ–‡
                self.memory.add_observation(observation)

        return "è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œä»»åŠ¡æœªå®Œæˆ"
```

---

## 3. å·¥å…·è°ƒç”¨æœºåˆ¶ (Tool Calling)

### 3.1 ä»€ä¹ˆæ˜¯å·¥å…·è°ƒç”¨ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å·¥å…·è°ƒç”¨æµç¨‹                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ç”¨æˆ·: "å¸®æˆ‘æŸ¥è¯¢åŒ—äº¬åˆ°ä¸Šæµ·çš„æœºç¥¨"                                     â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         LLM åˆ†æ                               â”‚ â”‚
â”‚  â”‚  "ç”¨æˆ·éœ€è¦æŸ¥è¯¢æœºç¥¨ï¼Œæˆ‘éœ€è¦è°ƒç”¨æœºç¥¨æŸ¥è¯¢å·¥å…·"                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ç”Ÿæˆå·¥å…·è°ƒç”¨è¯·æ±‚                           â”‚ â”‚
â”‚  â”‚  {                                                             â”‚ â”‚
â”‚  â”‚    "tool": "search_flights",                                   â”‚ â”‚
â”‚  â”‚    "arguments": {                                              â”‚ â”‚
â”‚  â”‚      "departure": "åŒ—äº¬",                                      â”‚ â”‚
â”‚  â”‚      "arrival": "ä¸Šæµ·",                                        â”‚ â”‚
â”‚  â”‚      "date": "2024-01-15"                                      â”‚ â”‚
â”‚  â”‚    }                                                           â”‚ â”‚
â”‚  â”‚  }                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      æ‰§è¡Œå·¥å…· & è¿”å›ç»“æœ                        â”‚ â”‚
â”‚  â”‚  èˆªç­åˆ—è¡¨: [CA1234, MU5678, ...]                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      LLM æ•´åˆå›å¤                               â”‚ â”‚
â”‚  â”‚  "ä¸ºæ‚¨æ‰¾åˆ°ä»¥ä¸‹èˆªç­: CA1234 08:00èµ·é£..."                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å·¥å…·å®šä¹‰è§„èŒƒ

```python
from typing import Callable, Any
from pydantic import BaseModel, Field

# æ–¹å¼ä¸€ï¼šä½¿ç”¨ JSON Schema å®šä¹‰å·¥å…·
tool_definition = {
    "type": "function",
    "function": {
        "name": "get_weather",
        "description": "è·å–æŒ‡å®šåŸå¸‚çš„å½“å‰å¤©æ°”ä¿¡æ¯",
        "parameters": {
            "type": "object",
            "properties": {
                "city": {
                    "type": "string",
                    "description": "åŸå¸‚åç§°ï¼Œå¦‚ 'åŒ—äº¬'"
                },
                "unit": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"],
                    "description": "æ¸©åº¦å•ä½"
                }
            },
            "required": ["city"]
        }
    }
}

# æ–¹å¼äºŒï¼šä½¿ç”¨ Pydantic æ¨¡å‹å®šä¹‰ï¼ˆæ¨èï¼‰
class GetWeatherInput(BaseModel):
    """è·å–å¤©æ°”çš„è¾“å…¥å‚æ•°"""
    city: str = Field(..., description="åŸå¸‚åç§°ï¼Œå¦‚ 'åŒ—äº¬'")
    unit: str = Field(default="celsius", description="æ¸©åº¦å•ä½")

class Tool(BaseModel):
    """å·¥å…·å®šä¹‰"""
    name: str
    description: str
    parameters: type[BaseModel]
    function: Callable

    def execute(self, **kwargs) -> Any:
        """æ‰§è¡Œå·¥å…·"""
        # éªŒè¯å‚æ•°
        validated_input = self.parameters(**kwargs)
        # æ‰§è¡Œå‡½æ•°
        return self.function(**validated_input.dict())
```

### 3.3 å®Œæ•´çš„å·¥å…·è°ƒç”¨å®ç°

```python
import json
from openai import OpenAI
from typing import List, Dict, Any

class ToolManager:
    """å·¥å…·ç®¡ç†å™¨"""

    def __init__(self):
        self.tools: Dict[str, Tool] = {}
        self.client = OpenAI()

    def register(self, tool: Tool):
        """æ³¨å†Œå·¥å…·"""
        self.tools[tool.name] = tool

    def get_tool_definitions(self) -> List[dict]:
        """è·å–æ‰€æœ‰å·¥å…·çš„ JSON Schema å®šä¹‰"""
        definitions = []
        for tool in self.tools.values():
            definitions.append({
                "type": "function",
                "function": {
                    "name": tool.name,
                    "description": tool.description,
                    "parameters": tool.parameters.schema()
                }
            })
        return definitions

    def execute_tool(self, name: str, arguments: dict) -> str:
        """æ‰§è¡ŒæŒ‡å®šå·¥å…·"""
        if name not in self.tools:
            return f"é”™è¯¯ï¼šæœªæ‰¾åˆ°å·¥å…· {name}"

        tool = self.tools[name]
        try:
            result = tool.execute(**arguments)
            return json.dumps(result, ensure_ascii=False)
        except Exception as e:
            return f"å·¥å…·æ‰§è¡Œé”™è¯¯ï¼š{str(e)}"


class ToolCallingAgent:
    """æ”¯æŒå·¥å…·è°ƒç”¨çš„ Agent"""

    def __init__(self, tool_manager: ToolManager):
        self.tool_manager = tool_manager
        self.client = OpenAI()
        self.messages: List[dict] = []

    def chat(self, user_message: str) -> str:
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""

        # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        self.messages.append({
            "role": "user",
            "content": user_message
        })

        # è°ƒç”¨ LLMï¼ˆå¸¦å·¥å…·å®šä¹‰ï¼‰
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=self.messages,
            tools=self.tool_manager.get_tool_definitions(),
            tool_choice="auto"  # è®©æ¨¡å‹è‡ªåŠ¨å†³å®šæ˜¯å¦ä½¿ç”¨å·¥å…·
        )

        assistant_message = response.choices[0].message

        # æ£€æŸ¥æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
        if assistant_message.tool_calls:
            # å¤„ç†å·¥å…·è°ƒç”¨
            self.messages.append(assistant_message.model_dump())

            for tool_call in assistant_message.tool_calls:
                function_name = tool_call.function.name
                function_args = json.loads(tool_call.function.arguments)

                # æ‰§è¡Œå·¥å…·
                result = self.tool_manager.execute_tool(
                    function_name,
                    function_args
                )

                # æ·»åŠ å·¥å…·ç»“æœåˆ°æ¶ˆæ¯
                self.messages.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "content": result
                })

            # è®© LLM åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆå›å¤
            final_response = self.client.chat.completions.create(
                model="gpt-4",
                messages=self.messages
            )

            final_content = final_response.choices[0].message.content
            self.messages.append({
                "role": "assistant",
                "content": final_content
            })

            return final_content

        else:
            # ç›´æ¥å›å¤
            content = assistant_message.content
            self.messages.append({
                "role": "assistant",
                "content": content
            })
            return content
```

### 3.4 ä½¿ç”¨ç¤ºä¾‹

```python
# å®šä¹‰å…·ä½“å·¥å…·
def get_weather(city: str, unit: str = "celsius") -> dict:
    """æ¨¡æ‹Ÿå¤©æ°”APIè°ƒç”¨"""
    # å®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šè°ƒç”¨çœŸå®çš„å¤©æ°”API
    return {
        "city": city,
        "temperature": 25,
        "unit": unit,
        "condition": "æ™´æœ—",
        "humidity": 60
    }

def search_web(query: str, num_results: int = 5) -> list:
    """æ¨¡æ‹Ÿç½‘ç»œæœç´¢"""
    return [
        {"title": f"æœç´¢ç»“æœ{i}", "url": f"https://example.com/{i}"}
        for i in range(num_results)
    ]

def calculate(expression: str) -> dict:
    """å®‰å…¨çš„æ•°å­¦è®¡ç®—"""
    try:
        result = eval(expression, {"__builtins__": {}}, {})
        return {"expression": expression, "result": result}
    except Exception as e:
        return {"error": str(e)}

# åˆ›å»ºå·¥å…·å®šä¹‰
class WeatherInput(BaseModel):
    city: str = Field(..., description="åŸå¸‚åç§°")
    unit: str = Field(default="celsius", description="æ¸©åº¦å•ä½")

class SearchInput(BaseModel):
    query: str = Field(..., description="æœç´¢å…³é”®è¯")
    num_results: int = Field(default=5, description="è¿”å›ç»“æœæ•°é‡")

class CalculateInput(BaseModel):
    expression: str = Field(..., description="æ•°å­¦è¡¨è¾¾å¼")

# æ³¨å†Œå·¥å…·
manager = ToolManager()

manager.register(Tool(
    name="get_weather",
    description="è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
    parameters=WeatherInput,
    function=get_weather
))

manager.register(Tool(
    name="search_web",
    description="åœ¨ç½‘ç»œä¸Šæœç´¢ä¿¡æ¯",
    parameters=SearchInput,
    function=search_web
))

manager.register(Tool(
    name="calculate",
    description="æ‰§è¡Œæ•°å­¦è®¡ç®—",
    parameters=CalculateInput,
    function=calculate
))

# ä½¿ç”¨ Agent
agent = ToolCallingAgent(manager)

# æµ‹è¯•
response = agent.chat("åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")
print(response)
# è¾“å‡º: åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©25Â°Cï¼Œæ¹¿åº¦60%ï¼Œéå¸¸é€‚åˆå¤–å‡ºæ´»åŠ¨ã€‚

response = agent.chat("è®¡ç®—ä¸€ä¸‹ (15 * 8 + 120) / 4 ç­‰äºå¤šå°‘")
print(response)
# è¾“å‡º: (15 * 8 + 120) / 4 çš„è®¡ç®—ç»“æœæ˜¯ 60ã€‚
```

---

## 4. ReAct æ¨¡å¼ï¼šæ¨ç†ä¸è¡ŒåŠ¨

### 4.1 ReAct æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ReAct = Reasoning + Acting                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜ï¼š                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ çº¯æ¨ç† (Chain-of-    â”‚     â”‚ çº¯è¡ŒåŠ¨ (Direct      â”‚            â”‚
â”‚   â”‚ Thought)              â”‚     â”‚ Action)              â”‚            â”‚
â”‚   â”‚                      â”‚     â”‚                      â”‚            â”‚
â”‚   â”‚ æ€è€ƒâ†’æ€è€ƒâ†’æ€è€ƒâ†’è¾“å‡º   â”‚     â”‚ è¾“å…¥â†’è¡ŒåŠ¨â†’è¾“å‡º       â”‚            â”‚
â”‚   â”‚                      â”‚     â”‚                      â”‚            â”‚
â”‚   â”‚ âŒ æ— æ³•è·å–æ–°ä¿¡æ¯     â”‚     â”‚ âŒ ç¼ºä¹è§„åˆ’å’Œåæ€    â”‚            â”‚
â”‚   â”‚ âŒ å®¹æ˜“äº§ç”Ÿå¹»è§‰       â”‚     â”‚ âŒ å®¹æ˜“é™·å…¥é”™è¯¯å¾ªç¯  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                     â”‚
â”‚   ReAct è§£å†³æ–¹æ¡ˆï¼š                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                              â”‚ â”‚
â”‚   â”‚    æ€è€ƒ (Thought) â”€â”€â†’ è¡ŒåŠ¨ (Action) â”€â”€â†’ è§‚å¯Ÿ (Observation)   â”‚ â”‚
â”‚   â”‚         â†‘                                      â”‚             â”‚ â”‚
â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚   â”‚                                                              â”‚ â”‚
â”‚   â”‚    âœ… æ¨ç†ä¸è¡ŒåŠ¨äº¤ç»‡                                          â”‚ â”‚
â”‚   â”‚    âœ… åŸºäºçœŸå®åé¦ˆè°ƒæ•´ç­–ç•¥                                     â”‚ â”‚
â”‚   â”‚    âœ… å¯è§£é‡Šçš„å†³ç­–è¿‡ç¨‹                                        â”‚ â”‚
â”‚   â”‚                                                              â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ReAct æ‰§è¡Œç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é—®é¢˜: "è‹¹æœå…¬å¸çš„å¸‚å€¼å’Œå¾®è½¯ç›¸æ¯”å¦‚ä½•ï¼Ÿè°çš„å¸‚å€¼æ›´é«˜ï¼Ÿ"                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ã€ç¬¬ä¸€è½®ã€‘                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Thought 1: æˆ‘éœ€è¦å…ˆæŸ¥è¯¢è‹¹æœå…¬å¸çš„å½“å‰å¸‚å€¼                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Action 1: search("è‹¹æœå…¬å¸å½“å‰å¸‚å€¼ 2024")                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Observation 1: è‹¹æœå…¬å¸å¸‚å€¼çº¦ä¸º 2.9 ä¸‡äº¿ç¾å…ƒ                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ã€ç¬¬äºŒè½®ã€‘                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Thought 2: æˆ‘å·²ç»çŸ¥é“è‹¹æœå¸‚å€¼ï¼Œç°åœ¨éœ€è¦æŸ¥è¯¢å¾®è½¯çš„å¸‚å€¼           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Action 2: search("å¾®è½¯å…¬å¸å½“å‰å¸‚å€¼ 2024")                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Observation 2: å¾®è½¯å…¬å¸å¸‚å€¼çº¦ä¸º 3.1 ä¸‡äº¿ç¾å…ƒ                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ã€ç¬¬ä¸‰è½®ã€‘                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Thought 3: æˆ‘ç°åœ¨æœ‰ä¸¤å®¶å…¬å¸çš„å¸‚å€¼æ•°æ®ï¼Œå¯ä»¥è¿›è¡Œæ¯”è¾ƒäº†          â”‚   â”‚
â”‚  â”‚ è‹¹æœ: 2.9ä¸‡äº¿, å¾®è½¯: 3.1ä¸‡äº¿ï¼Œå¾®è½¯å¸‚å€¼æ›´é«˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Final Answer: æ ¹æ®æœ€æ–°æ•°æ®ï¼Œå¾®è½¯å¸‚å€¼(3.1ä¸‡äº¿ç¾å…ƒ)é«˜äº          â”‚   â”‚
â”‚  â”‚ è‹¹æœå¸‚å€¼(2.9ä¸‡äº¿ç¾å…ƒ)ï¼Œå¾®è½¯å¸‚å€¼æ›´é«˜ã€‚                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ReAct Agent å®ç°

```python
from dataclasses import dataclass
from enum import Enum
from typing import Optional

class ActionType(Enum):
    SEARCH = "search"
    CALCULATE = "calculate"
    LOOKUP = "lookup"
    FINISH = "finish"

@dataclass
class ReActStep:
    """ReAct å•æ­¥"""
    thought: str
    action_type: ActionType
    action_input: str
    observation: Optional[str] = None

class ReActAgent:
    """ReAct Agent å®ç°"""

    REACT_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œä½¿ç”¨ ReAct æ–¹æ³•è§£å†³é—®é¢˜ã€‚

å¯ç”¨çš„å·¥å…·ï¼š
- search(query): æœç´¢äº’è”ç½‘è·å–ä¿¡æ¯
- calculate(expression): æ‰§è¡Œæ•°å­¦è®¡ç®—
- lookup(term): åœ¨çŸ¥è¯†åº“ä¸­æŸ¥æ‰¾æœ¯è¯­å®šä¹‰
- finish(answer): ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š

Thought: [ä½ çš„æ¨ç†è¿‡ç¨‹]
Action: [å·¥å…·åç§°]
Action Input: [å·¥å…·å‚æ•°]

ç­‰å¾…è§‚å¯Ÿç»“æœåç»§ç»­æ¨ç†ï¼Œç›´åˆ°å¯ä»¥ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚
å½“ä½ ç¡®å®šç­”æ¡ˆåï¼Œä½¿ç”¨ finish ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚

é—®é¢˜ï¼š{question}

{agent_scratchpad}
"""

    def __init__(self, tools: Dict[str, Callable]):
        self.tools = tools
        self.client = OpenAI()
        self.steps: List[ReActStep] = []

    def parse_action(self, response: str) -> tuple:
        """è§£æ LLM è¾“å‡ºçš„åŠ¨ä½œ"""
        import re

        # æå– Thought
        thought_match = re.search(r"Thought:\s*(.+?)(?=\nAction:)", response, re.DOTALL)
        thought = thought_match.group(1).strip() if thought_match else ""

        # æå– Action
        action_match = re.search(r"Action:\s*(\w+)", response)
        action = action_match.group(1) if action_match else "finish"

        # æå– Action Input
        input_match = re.search(r"Action Input:\s*(.+?)(?=\n|$)", response, re.DOTALL)
        action_input = input_match.group(1).strip() if input_match else ""

        return thought, action, action_input

    def format_scratchpad(self) -> str:
        """æ ¼å¼åŒ–å·²æœ‰çš„æ¨ç†æ­¥éª¤"""
        scratchpad = ""
        for step in self.steps:
            scratchpad += f"Thought: {step.thought}\n"
            scratchpad += f"Action: {step.action_type.value}\n"
            scratchpad += f"Action Input: {step.action_input}\n"
            if step.observation:
                scratchpad += f"Observation: {step.observation}\n"
        return scratchpad

    def run(self, question: str, max_steps: int = 10) -> str:
        """è¿è¡Œ ReAct å¾ªç¯"""

        self.steps = []

        for _ in range(max_steps):
            # æ„å»ºæç¤ºè¯
            prompt = self.REACT_PROMPT.format(
                question=question,
                agent_scratchpad=self.format_scratchpad()
            )

            # è°ƒç”¨ LLM
            response = self.client.chat.completions.create(
                model="gpt-4",
                messages=[{"role": "user", "content": prompt}],
                temperature=0
            )

            output = response.choices[0].message.content
            thought, action, action_input = self.parse_action(output)

            # æ£€æŸ¥æ˜¯å¦å®Œæˆ
            if action.lower() == "finish":
                return action_input

            # æ‰§è¡Œå·¥å…·
            if action.lower() in self.tools:
                observation = self.tools[action.lower()](action_input)
            else:
                observation = f"æœªçŸ¥å·¥å…·: {action}"

            # è®°å½•æ­¥éª¤
            self.steps.append(ReActStep(
                thought=thought,
                action_type=ActionType(action.lower()),
                action_input=action_input,
                observation=str(observation)
            ))

        return "è¾¾åˆ°æœ€å¤§æ­¥éª¤é™åˆ¶ï¼Œæœªèƒ½å¾—å‡ºç»“è®º"

# ä½¿ç”¨ç¤ºä¾‹
tools = {
    "search": lambda q: f"æœç´¢ç»“æœ: {q}çš„ç›¸å…³ä¿¡æ¯...",
    "calculate": lambda expr: str(eval(expr)),
    "lookup": lambda term: f"{term}çš„å®šä¹‰æ˜¯..."
}

agent = ReActAgent(tools)
answer = agent.run("2023å¹´ä¸­å›½GDPæ˜¯å¤šå°‘ï¼Ÿæ¢ç®—æˆæ¬§å…ƒæ˜¯å¤šå°‘ï¼Ÿ")
print(answer)
```

---

## 5. MCP åè®®è¯¦è§£

### 5.1 ä»€ä¹ˆæ˜¯ MCPï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MCP (Model Context Protocol)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   MCP æ˜¯ç”± Anthropic æå‡ºçš„å¼€æ”¾åè®®ï¼Œç”¨äºæ ‡å‡†åŒ– LLM åº”ç”¨ä¸å¤–éƒ¨         â”‚
â”‚   æ•°æ®æºå’Œå·¥å…·ä¹‹é—´çš„è¿æ¥æ–¹å¼ã€‚                                        â”‚
â”‚                                                                     â”‚
â”‚   ç±»æ¯”ç†è§£ï¼š                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                             â”‚  â”‚
â”‚   â”‚   USB ä¹‹äº ç¡¬ä»¶è®¾å¤‡  =  MCP ä¹‹äº AI åº”ç”¨                     â”‚  â”‚
â”‚   â”‚                                                             â”‚  â”‚
â”‚   â”‚   å°±åƒ USB è®©å„ç§è®¾å¤‡ç”¨ç»Ÿä¸€æ¥å£è¿æ¥ç”µè„‘ä¸€æ ·ï¼Œ                   â”‚  â”‚
â”‚   â”‚   MCP è®©å„ç§æ•°æ®æºå’Œå·¥å…·ç”¨ç»Ÿä¸€åè®®è¿æ¥ AI åº”ç”¨                  â”‚  â”‚
â”‚   â”‚                                                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚   æ ¸å¿ƒä»·å€¼ï¼š                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚  æ ‡å‡†åŒ–    â”‚  â”‚  å¯å¤ç”¨    â”‚  â”‚  å®‰å…¨      â”‚                   â”‚
â”‚   â”‚  ç»Ÿä¸€åè®®  â”‚  â”‚  æ’ä»¶ç”Ÿæ€  â”‚  â”‚  æƒé™æ§åˆ¶  â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 MCP æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MCP æ¶æ„å›¾                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                      MCP Hosts (å®¿ä¸»)                         â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚   â”‚  â”‚  Claude     â”‚  â”‚   IDE       â”‚  â”‚   Custom    â”‚          â”‚ â”‚
â”‚   â”‚  â”‚  Desktop    â”‚  â”‚  (Cursor)   â”‚  â”‚   App       â”‚          â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                â”‚                â”‚                     â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                    MCP Client (å®¢æˆ·ç«¯)                        â”‚ â”‚
â”‚   â”‚         è´Ÿè´£ç»´æŠ¤ä¸ Server çš„è¿æ¥ï¼Œå¤„ç†åè®®é€šä¿¡                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚               â”‚              â”‚              â”‚                       â”‚
â”‚               â–¼              â–¼              â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                   MCP Servers (æœåŠ¡ç«¯)                        â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚  â”‚ Database  â”‚  â”‚   File    â”‚  â”‚   API     â”‚  â”‚  Custom   â”‚ â”‚ â”‚
â”‚   â”‚  â”‚  Server   â”‚  â”‚  System   â”‚  â”‚  Server   â”‚  â”‚  Server   â”‚ â”‚ â”‚
â”‚   â”‚  â”‚           â”‚  â”‚  Server   â”‚  â”‚           â”‚  â”‚           â”‚ â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚              â”‚              â”‚              â”‚          â”‚
â”‚            â–¼              â–¼              â–¼              â–¼          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                     æ•°æ®æº / æœåŠ¡                             â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚  â”‚ MySQL   â”‚  â”‚ æœ¬åœ°    â”‚  â”‚ GitHub  â”‚  â”‚ Slack/é‚®ä»¶/...  â”‚ â”‚ â”‚
â”‚   â”‚  â”‚ MongoDB â”‚  â”‚ æ–‡ä»¶    â”‚  â”‚ GitLab  â”‚  â”‚                 â”‚ â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 MCP æ ¸å¿ƒæ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCP ä¸‰å¤§æ ¸å¿ƒåŸè¯­                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Resources (èµ„æº)                                         â”‚   â”‚
â”‚  â”‚     â€¢ å‘ LLM æš´éœ²æ•°æ®å’Œå†…å®¹                                    â”‚   â”‚
â”‚  â”‚     â€¢ ç±»ä¼¼äº GET è¯·æ±‚ï¼Œç”¨äºè¯»å–æ•°æ®                            â”‚   â”‚
â”‚  â”‚     â€¢ ä¾‹å¦‚ï¼šæ–‡ä»¶å†…å®¹ã€æ•°æ®åº“è®°å½•ã€API å“åº”                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚     URIæ ¼å¼: file:///path/to/file                            â”‚   â”‚
â”‚  â”‚              db://database/table/record                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. Tools (å·¥å…·)                                             â”‚   â”‚
â”‚  â”‚     â€¢ å‘ LLM æš´éœ²å¯æ‰§è¡Œçš„åŠŸèƒ½                                  â”‚   â”‚
â”‚  â”‚     â€¢ ç±»ä¼¼äº POST è¯·æ±‚ï¼Œç”¨äºæ‰§è¡Œæ“ä½œ                           â”‚   â”‚
â”‚  â”‚     â€¢ ä¾‹å¦‚ï¼šå‘é€é‚®ä»¶ã€åˆ›å»ºæ–‡ä»¶ã€æ‰§è¡ŒæŸ¥è¯¢                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚     å®šä¹‰: name + description + inputSchema                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. Prompts (æç¤ºè¯æ¨¡æ¿)                                      â”‚   â”‚
â”‚  â”‚     â€¢ é¢„å®šä¹‰çš„æç¤ºè¯æ¨¡æ¿                                       â”‚   â”‚
â”‚  â”‚     â€¢ å¯å¤ç”¨çš„äº¤äº’æ¨¡å¼                                        â”‚   â”‚
â”‚  â”‚     â€¢ ä¾‹å¦‚ï¼šä»£ç å®¡æŸ¥æ¨¡æ¿ã€æ•°æ®åˆ†ææ¨¡æ¿                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚     æ”¯æŒ: å‚æ•°åŒ– + åŠ¨æ€å†…å®¹                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 MCP Server å®ç°

````python
# mcp_server.py
from mcp.server import Server
from mcp.server.stdio import stdio_server
from mcp.types import (
    Resource,
    Tool,
    TextContent,
    INVALID_PARAMS,
    INTERNAL_ERROR
)
import json
import asyncio

# åˆ›å»º MCP Server å®ä¾‹
server = Server("my-mcp-server")

# ==================== Resources ====================

@server.list_resources()
async def list_resources():
    """åˆ—å‡ºå¯ç”¨èµ„æº"""
    return [
        Resource(
            uri="file:///config/settings.json",
            name="åº”ç”¨é…ç½®",
            description="åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶",
            mimeType="application/json"
        ),
        Resource(
            uri="db://users/profile",
            name="ç”¨æˆ·èµ„æ–™",
            description="å½“å‰ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯",
            mimeType="application/json"
        )
    ]

@server.read_resource()
async def read_resource(uri: str):
    """è¯»å–èµ„æºå†…å®¹"""
    if uri == "file:///config/settings.json":
        config = {
            "app_name": "My Application",
            "version": "1.0.0",
            "debug": True
        }
        return json.dumps(config, indent=2)

    elif uri == "db://users/profile":
        profile = {
            "username": "john_doe",
            "email": "john@example.com",
            "role": "admin"
        }
        return json.dumps(profile, indent=2)

    raise ValueError(f"æœªçŸ¥èµ„æº: {uri}")

# ==================== Tools ====================

@server.list_tools()
async def list_tools():
    """åˆ—å‡ºå¯ç”¨å·¥å…·"""
    return [
        Tool(
            name="send_email",
            description="å‘é€ç”µå­é‚®ä»¶",
            inputSchema={
                "type": "object",
                "properties": {
                    "to": {
                        "type": "string",
                        "description": "æ”¶ä»¶äººé‚®ç®±åœ°å€"
                    },
                    "subject": {
                        "type": "string",
                        "description": "é‚®ä»¶ä¸»é¢˜"
                    },
                    "body": {
                        "type": "string",
                        "description": "é‚®ä»¶æ­£æ–‡"
                    }
                },
                "required": ["to", "subject", "body"]
            }
        ),
        Tool(
            name="query_database",
            description="æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢",
            inputSchema={
                "type": "object",
                "properties": {
                    "sql": {
                        "type": "string",
                        "description": "SQL æŸ¥è¯¢è¯­å¥"
                    },
                    "database": {
                        "type": "string",
                        "description": "æ•°æ®åº“åç§°"
                    }
                },
                "required": ["sql"]
            }
        ),
        Tool(
            name="create_file",
            description="åˆ›å»ºæ–°æ–‡ä»¶",
            inputSchema={
                "type": "object",
                "properties": {
                    "path": {
                        "type": "string",
                        "description": "æ–‡ä»¶è·¯å¾„"
                    },
                    "content": {
                        "type": "string",
                        "description": "æ–‡ä»¶å†…å®¹"
                    }
                },
                "required": ["path", "content"]
            }
        )
    ]

@server.call_tool()
async def call_tool(name: str, arguments: dict):
    """æ‰§è¡Œå·¥å…·"""

    if name == "send_email":
        # æ¨¡æ‹Ÿå‘é€é‚®ä»¶
        to = arguments.get("to")
        subject = arguments.get("subject")
        body = arguments.get("body")

        # å®é™…å®ç°ä¸­è¿™é‡Œä¼šè°ƒç”¨é‚®ä»¶æœåŠ¡
        return [TextContent(
            type="text",
            text=f"é‚®ä»¶å·²å‘é€è‡³ {to}\nä¸»é¢˜: {subject}"
        )]

    elif name == "query_database":
        sql = arguments.get("sql")
        database = arguments.get("database", "default")

        # æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        mock_result = [
            {"id": 1, "name": "Alice", "age": 30},
            {"id": 2, "name": "Bob", "age": 25}
        ]

        return [TextContent(
            type="text",
            text=json.dumps(mock_result, indent=2)
        )]

    elif name == "create_file":
        path = arguments.get("path")
        content = arguments.get("content")

        # å®é™…å®ç°ä¸­è¿™é‡Œä¼šåˆ›å»ºæ–‡ä»¶
        return [TextContent(
            type="text",
            text=f"æ–‡ä»¶å·²åˆ›å»º: {path}"
        )]

    raise ValueError(f"æœªçŸ¥å·¥å…·: {name}")

# ==================== Prompts ====================

@server.list_prompts()
async def list_prompts():
    """åˆ—å‡ºå¯ç”¨æç¤ºè¯æ¨¡æ¿"""
    from mcp.types import Prompt, PromptArgument

    return [
        Prompt(
            name="code_review",
            description="ä»£ç å®¡æŸ¥æç¤ºè¯æ¨¡æ¿",
            arguments=[
                PromptArgument(
                    name="code",
                    description="éœ€è¦å®¡æŸ¥çš„ä»£ç ",
                    required=True
                ),
                PromptArgument(
                    name="language",
                    description="ç¼–ç¨‹è¯­è¨€",
                    required=False
                )
            ]
        ),
        Prompt(
            name="summarize",
            description="æ–‡æœ¬æ€»ç»“æç¤ºè¯æ¨¡æ¿",
            arguments=[
                PromptArgument(
                    name="text",
                    description="éœ€è¦æ€»ç»“çš„æ–‡æœ¬",
                    required=True
                ),
                PromptArgument(
                    name="max_length",
                    description="æœ€å¤§é•¿åº¦",
                    required=False
                )
            ]
        )
    ]

@server.get_prompt()
async def get_prompt(name: str, arguments: dict):
    """è·å–æç¤ºè¯å†…å®¹"""
    from mcp.types import PromptMessage, TextContent

    if name == "code_review":
        code = arguments.get("code", "")
        language = arguments.get("language", "unknown")

        return {
            "messages": [
                PromptMessage(
                    role="user",
                    content=TextContent(
                        type="text",
                        text=f"""è¯·å¯¹ä»¥ä¸‹ {language} ä»£ç è¿›è¡Œå®¡æŸ¥ï¼š

```{language}
{code}
````

è¯·ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œè¯„ä¼°ï¼š

1.  ä»£ç è´¨é‡å’Œå¯è¯»æ€§
2.  æ½œåœ¨çš„ Bug æˆ–é—®é¢˜
3.  æ€§èƒ½ä¼˜åŒ–å»ºè®®
4.  æœ€ä½³å®è·µéµå¾ªæƒ…å†µ
    """
    )
    )
    ]
    }
    raise ValueError(f"æœªçŸ¥æç¤ºè¯æ¨¡æ¿: {name}")

# å¯åŠ¨æœåŠ¡å™¨

async def main():
async with stdio_server() as (read_stream, write_stream):
await server.run(
read_stream,
write_stream,
server.create_initialization_options()
)

if **name** == "**main**":
asyncio.run(main())

```

```

### 5.5 MCP Client å®ç°

```python
# mcp_client.py
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client
import asyncio
import json

class MCPClient:
    """MCP å®¢æˆ·ç«¯å°è£…"""

    def __init__(self):
        self.session: ClientSession = None
        self.tools = []
        self.resources = []

    async def connect(self, server_command: str, args: list = None):
        """è¿æ¥åˆ° MCP Server"""
        server_params = StdioServerParameters(
            command=server_command,
            args=args or []
        )

        transport = await stdio_client(server_params)
        self.read, self.write = transport
        self.session = ClientSession(self.read, self.write)

        # åˆå§‹åŒ–è¿æ¥
        await self.session.initialize()

        # è·å–å¯ç”¨å·¥å…·å’Œèµ„æº
        await self._fetch_capabilities()

    async def _fetch_capabilities(self):
        """è·å–æœåŠ¡å™¨èƒ½åŠ›"""
        # è·å–å·¥å…·åˆ—è¡¨
        tools_response = await self.session.list_tools()
        self.tools = tools_response.tools

        # è·å–èµ„æºåˆ—è¡¨
        resources_response = await self.session.list_resources()
        self.resources = resources_response.resources

    async def call_tool(self, name: str, arguments: dict) -> str:
        """è°ƒç”¨å·¥å…·"""
        result = await self.session.call_tool(name, arguments)

        # æå–æ–‡æœ¬å†…å®¹
        texts = []
        for content in result.content:
            if hasattr(content, 'text'):
                texts.append(content.text)

        return "\n".join(texts)

    async def read_resource(self, uri: str) -> str:
        """è¯»å–èµ„æº"""
        result = await self.session.read_resource(uri)

        texts = []
        for content in result.contents:
            if hasattr(content, 'text'):
                texts.append(content.text)

        return "\n".join(texts)

    def get_tools_for_llm(self) -> list:
        """è·å–å·¥å…·å®šä¹‰ä¾› LLM ä½¿ç”¨"""
        return [
            {
                "type": "function",
                "function": {
                    "name": tool.name,
                    "description": tool.description,
                    "parameters": tool.inputSchema
                }
            }
            for tool in self.tools
        ]

    async def close(self):
        """å…³é—­è¿æ¥"""
        if self.session:
            await self.session.close()


# é›†æˆåˆ° Agent
class MCPAgent:
    """åŸºäº MCP çš„ Agent"""

    def __init__(self):
        self.mcp_client = MCPClient()
        self.client = OpenAI()
        self.messages = []

    async def setup(self, server_configs: list):
        """è®¾ç½® MCP è¿æ¥"""
        for config in server_configs:
            await self.mcp_client.connect(
                config["command"],
                config.get("args", [])
            )

    async def chat(self, user_message: str) -> str:
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
        self.messages.append({
            "role": "user",
            "content": user_message
        })

        # è·å– MCP å·¥å…·å®šä¹‰
        tools = self.mcp_client.get_tools_for_llm()

        # è°ƒç”¨ LLM
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=self.messages,
            tools=tools,
            tool_choice="auto"
        )

        assistant_message = response.choices[0].message

        if assistant_message.tool_calls:
            self.messages.append(assistant_message.model_dump())

            for tool_call in assistant_message.tool_calls:
                # é€šè¿‡ MCP è°ƒç”¨å·¥å…·
                result = await self.mcp_client.call_tool(
                    tool_call.function.name,
                    json.loads(tool_call.function.arguments)
                )

                self.messages.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "content": result
                })

            # ç”Ÿæˆæœ€ç»ˆå›å¤
            final_response = self.client.chat.completions.create(
                model="gpt-4",
                messages=self.messages
            )

            return final_response.choices[0].message.content

        return assistant_message.content


# ä½¿ç”¨ç¤ºä¾‹
async def main():
    agent = MCPAgent()

    # è¿æ¥ MCP æœåŠ¡å™¨
    await agent.setup([
        {
            "command": "python",
            "args": ["mcp_server.py"]
        }
    ])

    # å¯¹è¯
    response = await agent.chat("æŸ¥è¯¢ä¸€ä¸‹ç”¨æˆ·èµ„æ–™")
    print(response)

    response = await agent.chat("ç»™ test@example.com å‘ä¸€å°é‚®ä»¶ï¼Œä¸»é¢˜æ˜¯æµ‹è¯•")
    print(response)

if __name__ == "__main__":
    asyncio.run(main())
```

### 5.6 MCP é…ç½®æ–‡ä»¶

```json
// claude_desktop_config.json (Claude Desktop é…ç½®ç¤ºä¾‹)
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "/path/to/allowed/directory"
      ]
    },
    "database": {
      "command": "python",
      "args": ["./my_db_server.py"],
      "env": {
        "DATABASE_URL": "postgresql://localhost/mydb"
      }
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_TOKEN": "your-github-token"
      }
    }
  }
}
```

---

## 6. å®æˆ˜ï¼šæ„å»ºå®Œæ•´ Agent

### 6.1 é¡¹ç›®ç»“æ„

```
my_agent/
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core.py          # Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ memory.py        # è®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ planning.py      # è§„åˆ’æ¨¡å—
â”‚   â””â”€â”€ tools/           # å·¥å…·ç›®å½•
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ base.py      # å·¥å…·åŸºç±»
â”‚       â”œâ”€â”€ search.py    # æœç´¢å·¥å…·
â”‚       â”œâ”€â”€ calculator.py # è®¡ç®—å·¥å…·
â”‚       â””â”€â”€ file_ops.py  # æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ mcp/
â”‚   â”œâ”€â”€ server.py        # MCP æœåŠ¡å™¨
â”‚   â””â”€â”€ client.py        # MCP å®¢æˆ·ç«¯
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py      # é…ç½®
â”œâ”€â”€ main.py              # å…¥å£
â””â”€â”€ requirements.txt
```

### 6.2 å®Œæ•´å®ç°

```python
# agent/tools/base.py
from abc import ABC, abstractmethod
from pydantic import BaseModel
from typing import Any, Type

class BaseTool(ABC):
    """å·¥å…·åŸºç±»"""

    name: str
    description: str
    args_schema: Type[BaseModel]

    @abstractmethod
    def run(self, **kwargs) -> Any:
        """æ‰§è¡Œå·¥å…·"""
        pass

    def to_openai_schema(self) -> dict:
        """è½¬æ¢ä¸º OpenAI å·¥å…·æ ¼å¼"""
        return {
            "type": "function",
            "function": {
                "name": self.name,
                "description": self.description,
                "parameters": self.args_schema.model_json_schema()
            }
        }


# agent/tools/search.py
import httpx
from pydantic import BaseModel, Field

class SearchInput(BaseModel):
    query: str = Field(..., description="æœç´¢å…³é”®è¯")
    num_results: int = Field(default=5, description="è¿”å›ç»“æœæ•°é‡")

class SearchTool(BaseTool):
    name = "web_search"
    description = "åœ¨ç½‘ç»œä¸Šæœç´¢ä¿¡æ¯ï¼Œé€‚ç”¨äºéœ€è¦è·å–æœ€æ–°ä¿¡æ¯çš„åœºæ™¯"
    args_schema = SearchInput

    def __init__(self, api_key: str):
        self.api_key = api_key

    def run(self, query: str, num_results: int = 5) -> list:
        # ä½¿ç”¨æœç´¢ API (ç¤ºä¾‹ç”¨ Serper)
        response = httpx.post(
            "https://google.serper.dev/search",
            headers={"X-API-KEY": self.api_key},
            json={"q": query, "num": num_results}
        )
        results = response.json().get("organic", [])
        return [
            {"title": r["title"], "snippet": r["snippet"], "link": r["link"]}
            for r in results
        ]


# agent/memory.py
from typing import List, Dict, Any, Optional
from dataclasses import dataclass, field
from datetime import datetime
import json

@dataclass
class Message:
    role: str
    content: str
    timestamp: datetime = field(default_factory=datetime.now)
    metadata: Dict[str, Any] = field(default_factory=dict)

class ConversationMemory:
    """å¯¹è¯è®°å¿†"""

    def __init__(self, max_messages: int = 50):
        self.messages: List[Message] = []
        self.max_messages = max_messages

    def add(self, role: str, content: str, **metadata):
        """æ·»åŠ æ¶ˆæ¯"""
        self.messages.append(Message(
            role=role,
            content=content,
            metadata=metadata
        ))

        # è¶…è¿‡é™åˆ¶æ—¶å‹ç¼©
        if len(self.messages) > self.max_messages:
            self._compress()

    def _compress(self):
        """å‹ç¼©æ—§æ¶ˆæ¯"""
        # ä¿ç•™æœ€è¿‘çš„æ¶ˆæ¯ï¼Œå‹ç¼©æ—§æ¶ˆæ¯ä¸ºæ‘˜è¦
        old_messages = self.messages[:-10]
        recent_messages = self.messages[-10:]

        # åˆ›å»ºæ‘˜è¦
        summary = self._summarize(old_messages)

        self.messages = [
            Message(role="system", content=f"[å†å²æ‘˜è¦]: {summary}")
        ] + recent_messages

    def _summarize(self, messages: List[Message]) -> str:
        """ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦"""
        # ç®€å•å®ç°ï¼Œå®é™…å¯è°ƒç”¨ LLM ç”Ÿæˆ
        return f"è¿‡å»çš„ {len(messages)} æ¡æ¶ˆæ¯çš„æ‘˜è¦..."

    def get_context(self) -> List[dict]:
        """è·å–ä¸Šä¸‹æ–‡"""
        return [
            {"role": m.role, "content": m.content}
            for m in self.messages
        ]

    def clear(self):
        """æ¸…ç©ºè®°å¿†"""
        self.messages = []


# agent/core.py
from openai import OpenAI
from typing import List, Dict, Any, Optional
import json

class Agent:
    """å®Œæ•´çš„ Agent å®ç°"""

    def __init__(
        self,
        model: str = "gpt-4",
        system_prompt: Optional[str] = None,
        tools: Optional[List[BaseTool]] = None,
        max_iterations: int = 10,
        verbose: bool = True
    ):
        self.model = model
        self.client = OpenAI()
        self.memory = ConversationMemory()
        self.tools = {t.name: t for t in (tools or [])}
        self.max_iterations = max_iterations
        self.verbose = verbose

        # ç³»ç»Ÿæç¤ºè¯
        self.system_prompt = system_prompt or """
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œèƒ½å¤Ÿä½¿ç”¨å„ç§å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚

åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
1. ä»”ç»†åˆ†æç”¨æˆ·éœ€æ±‚
2. é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·
3. å¦‚æœä¸€ä¸ªå·¥å…·ä¸å¤Ÿï¼Œå¯ä»¥ç»„åˆå¤šä¸ªå·¥å…·
4. å§‹ç»ˆåŸºäºçœŸå®æ•°æ®ç»™å‡ºå›ç­”
5. å¦‚æœä¸ç¡®å®šï¼Œå¦è¯šå‘ŠçŸ¥ç”¨æˆ·
"""

        # æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
        self.memory.add("system", self.system_prompt)

    def _get_tool_schemas(self) -> List[dict]:
        """è·å–å·¥å…· Schema"""
        return [tool.to_openai_schema() for tool in self.tools.values()]

    def _execute_tool(self, name: str, arguments: dict) -> str:
        """æ‰§è¡Œå·¥å…·"""
        if name not in self.tools:
            return f"é”™è¯¯ï¼šæœªæ‰¾åˆ°å·¥å…· '{name}'"

        tool = self.tools[name]
        try:
            result = tool.run(**arguments)
            return json.dumps(result, ensure_ascii=False, indent=2)
        except Exception as e:
            return f"å·¥å…·æ‰§è¡Œé”™è¯¯ï¼š{str(e)}"

    def _log(self, message: str):
        """è¾“å‡ºæ—¥å¿—"""
        if self.verbose:
            print(f"[Agent] {message}")

    def chat(self, user_input: str) -> str:
        """å¤„ç†ç”¨æˆ·è¾“å…¥"""

        self._log(f"æ”¶åˆ°ç”¨æˆ·è¾“å…¥: {user_input}")
        self.memory.add("user", user_input)

        for iteration in range(self.max_iterations):
            self._log(f"è¿­ä»£ {iteration + 1}/{self.max_iterations}")

            # æ„å»ºæ¶ˆæ¯
            messages = self.memory.get_context()

            # è°ƒç”¨ LLM
            response = self.client.chat.completions.create(
                model=self.model,
                messages=messages,
                tools=self._get_tool_schemas() if self.tools else None,
                tool_choice="auto" if self.tools else None,
                temperature=0.7
            )

            assistant_message = response.choices[0].message

            # æ£€æŸ¥æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
            if assistant_message.tool_calls:
                self._log(f"éœ€è¦è°ƒç”¨ {len(assistant_message.tool_calls)} ä¸ªå·¥å…·")

                # æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯
                self.memory.add(
                    "assistant",
                    assistant_message.content or "",
                    tool_calls=[tc.model_dump() for tc in assistant_message.tool_calls]
                )

                # æ‰§è¡Œæ¯ä¸ªå·¥å…·è°ƒç”¨
                for tool_call in assistant_message.tool_calls:
                    func_name = tool_call.function.name
                    func_args = json.loads(tool_call.function.arguments)

                    self._log(f"è°ƒç”¨å·¥å…·: {func_name}({func_args})")

                    result = self._execute_tool(func_name, func_args)

                    self._log(f"å·¥å…·ç»“æœ: {result[:100]}...")

                    # æ·»åŠ å·¥å…·ç»“æœ
                    self.memory.add(
                        "tool",
                        result,
                        tool_call_id=tool_call.id,
                        name=func_name
                    )

            else:
                # æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å›æœ€ç»ˆç­”æ¡ˆ
                final_response = assistant_message.content
                self.memory.add("assistant", final_response)

                self._log(f"æœ€ç»ˆå›å¤: {final_response[:100]}...")
                return final_response

        return "æŠ±æ­‰ï¼Œæˆ‘æ— æ³•åœ¨è§„å®šçš„æ­¥éª¤å†…å®Œæˆä»»åŠ¡ã€‚è¯·å°è¯•ç®€åŒ–æ‚¨çš„è¯·æ±‚ã€‚"

    def reset(self):
        """é‡ç½®å¯¹è¯"""
        self.memory.clear()
        self.memory.add("system", self.system_prompt)


# main.py
from agent.core import Agent
from agent.tools.search import SearchTool
from agent.tools.calculator import CalculatorTool

def main():
    # åˆ›å»ºå·¥å…·
    tools = [
        SearchTool(api_key="your-api-key"),
        CalculatorTool()
    ]

    # åˆ›å»º Agent
    agent = Agent(
        model="gpt-4",
        tools=tools,
        verbose=True
    )

    # äº¤äº’å¾ªç¯
    print("Agent å·²å¯åŠ¨ï¼Œè¾“å…¥ 'quit' é€€å‡º")
    print("-" * 50)

    while True:
        user_input = input("\nä½ : ").strip()

        if user_input.lower() in ['quit', 'exit', 'q']:
            print("å†è§ï¼")
            break

        if not user_input:
            continue

        response = agent.chat(user_input)
        print(f"\nAgent: {response}")

if __name__ == "__main__":
    main()
```

### 6.3 è¿è¡Œæ•ˆæœ

```
Agent å·²å¯åŠ¨ï¼Œè¾“å…¥ 'quit' é€€å‡º
--------------------------------------------------

ä½ : å¸®æˆ‘æŸ¥ä¸€ä¸‹ä»Šå¤©çš„ç§‘æŠ€æ–°é—»ï¼Œç„¶åè®¡ç®—ä¸€ä¸‹å¦‚æœè‹¹æœè‚¡ä»·200ç¾å…ƒï¼Œä¹°100è‚¡éœ€è¦å¤šå°‘é’±

[Agent] æ”¶åˆ°ç”¨æˆ·è¾“å…¥: å¸®æˆ‘æŸ¥ä¸€ä¸‹ä»Šå¤©çš„ç§‘æŠ€æ–°é—»...
[Agent] è¿­ä»£ 1/10
[Agent] éœ€è¦è°ƒç”¨ 2 ä¸ªå·¥å…·
[Agent] è°ƒç”¨å·¥å…·: web_search({"query": "ä»Šæ—¥ç§‘æŠ€æ–°é—»", "num_results": 5})
[Agent] å·¥å…·ç»“æœ: [{"title": "è‹¹æœå‘å¸ƒæ–°æ¬¾MacBook...", ...}]
[Agent] è°ƒç”¨å·¥å…·: calculator({"expression": "200 * 100"})
[Agent] å·¥å…·ç»“æœ: {"result": 20000}
[Agent] è¿­ä»£ 2/10
[Agent] æœ€ç»ˆå›å¤: æ ¹æ®æˆ‘æœç´¢åˆ°çš„ä»Šæ—¥ç§‘æŠ€æ–°é—»...

Agent:
## ä»Šæ—¥ç§‘æŠ€æ–°é—»æ‘˜è¦

1. **è‹¹æœå‘å¸ƒæ–°æ¬¾ MacBook Pro** - æ­è½½ M3 èŠ¯ç‰‡...
2. **Google æ¨å‡º Gemini æ¨¡å‹** - å¤šæ¨¡æ€èƒ½åŠ›å¤§å¹…æå‡...
3. **ç‰¹æ–¯æ‹‰ Cybertruck å¼€å§‹äº¤ä»˜** - é¦–æ‰¹è½¦ä¸»å·²æ”¶åˆ°...

## è‚¡ç¥¨è®¡ç®—

å¦‚æœè‹¹æœè‚¡ä»·ä¸º **200 ç¾å…ƒ**ï¼Œè´­ä¹° **100 è‚¡**éœ€è¦ï¼š
- æ€»é‡‘é¢ï¼š**$20,000 ç¾å…ƒ**

éœ€è¦æˆ‘å¸®æ‚¨æŸ¥è¯¢è‹¹æœå½“å‰çš„å®é™…è‚¡ä»·å—ï¼Ÿ
```

---

## 7. æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±

### 7.1 æœ€ä½³å®è·µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent å¼€å‘æœ€ä½³å®è·µ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ“Œ å·¥å…·è®¾è®¡                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… DO                          â”‚ âŒ DON'T                   â”‚   â”‚
â”‚  â”‚ â€¢ å·¥å…·åŠŸèƒ½å•ä¸€æ˜ç¡®              â”‚ â€¢ å·¥å…·åŠŸèƒ½è¿‡äºå¤æ‚          â”‚   â”‚
â”‚  â”‚ â€¢ æ¸…æ™°çš„å‚æ•°æè¿°               â”‚ â€¢ æ¨¡ç³Šçš„æè¿°               â”‚   â”‚
â”‚  â”‚ â€¢ å®Œå–„çš„é”™è¯¯å¤„ç†               â”‚ â€¢ åæ‰å¼‚å¸¸                 â”‚   â”‚
â”‚  â”‚ â€¢ è¿”å›ç»“æ„åŒ–æ•°æ®               â”‚ â€¢ è¿”å›å¤§é‡åŸå§‹æ•°æ®          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Œ æç¤ºè¯å·¥ç¨‹                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… DO                          â”‚ âŒ DON'T                   â”‚   â”‚
â”‚  â”‚ â€¢ æä¾›æ¸…æ™°çš„è§’è‰²å®šä¹‰            â”‚ â€¢ æ¨¡ç³Šçš„æŒ‡ä»¤               â”‚   â”‚
â”‚  â”‚ â€¢ åŒ…å«ä½¿ç”¨å·¥å…·çš„ç¤ºä¾‹            â”‚ â€¢ å‡è®¾æ¨¡å‹ä¼šç†è§£æ„å›¾        â”‚   â”‚
â”‚  â”‚ â€¢ è®¾å®šè¾¹ç•Œå’Œé™åˆ¶               â”‚ â€¢ ç»™äºˆæ— é™åˆ¶çš„æƒé™          â”‚   â”‚
â”‚  â”‚ â€¢ å®šä¹‰è¾“å‡ºæ ¼å¼                 â”‚ â€¢ æœŸæœ›æ¨¡å‹çŒœæµ‹æ ¼å¼          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Œ é”™è¯¯å¤„ç†                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… DO                          â”‚ âŒ DON'T                   â”‚   â”‚
â”‚  â”‚ â€¢ è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°             â”‚ â€¢ æ— é™å¾ªç¯é£é™©             â”‚   â”‚
â”‚  â”‚ â€¢ å·¥å…·è°ƒç”¨è¶…æ—¶                 â”‚ â€¢ é˜»å¡ç­‰å¾…                 â”‚   â”‚
â”‚  â”‚ â€¢ ä¼˜é›…é™çº§                     â”‚ â€¢ ç›´æ¥å´©æºƒ                 â”‚   â”‚
â”‚  â”‚ â€¢ è¯¦ç»†çš„æ—¥å¿—è®°å½•               â”‚ â€¢ é»‘ç›’è¿è¡Œ                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

```python
# âŒ é™·é˜±1ï¼šå·¥å…·æè¿°ä¸æ¸…æ™°
bad_tool = {
    "name": "search",
    "description": "æœç´¢"  # å¤ªç®€çŸ­
}

# âœ… æ”¹è¿›
good_tool = {
    "name": "web_search",
    "description": "åœ¨äº’è”ç½‘ä¸Šæœç´¢ä¿¡æ¯ã€‚é€‚ç”¨äºéœ€è¦æŸ¥æ‰¾æœ€æ–°æ–°é—»ã€äº‹å®ã€"
                   "ç»Ÿè®¡æ•°æ®ç­‰åœºæ™¯ã€‚ä¸é€‚ç”¨äºæ•°å­¦è®¡ç®—æˆ–ä»£ç æ‰§è¡Œã€‚"
}

# âŒ é™·é˜±2ï¼šæ— é™å¾ªç¯
def bad_agent_loop():
    while True:  # å±é™©ï¼šå¯èƒ½æ°¸è¿œä¸ä¼šåœæ­¢
        response = llm.chat()
        if response.tool_calls:
            execute_tools()

# âœ… æ”¹è¿›
def good_agent_loop(max_iterations=10):
    for i in range(max_iterations):
        response = llm.chat()
        if not response.tool_calls:
            return response.content
        execute_tools()
    return "è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°"

# âŒ é™·é˜±3ï¼šæœªéªŒè¯å·¥å…·è¾“å…¥
def bad_tool_execution(args: dict):
    path = args["path"]
    os.remove(path)  # å±é™©ï¼šå¯èƒ½åˆ é™¤é‡è¦æ–‡ä»¶

# âœ… æ”¹è¿›
def good_tool_execution(args: dict):
    path = args["path"]

    # éªŒè¯è·¯å¾„
    allowed_paths = ["/tmp/", "/home/user/workspace/"]
    if not any(path.startswith(p) for p in allowed_paths):
        return {"error": "ä¸å…è®¸è®¿é—®è¯¥è·¯å¾„"}

    # ç¡®è®¤æ–‡ä»¶å­˜åœ¨
    if not os.path.exists(path):
        return {"error": "æ–‡ä»¶ä¸å­˜åœ¨"}

    os.remove(path)
    return {"success": True}

# âŒ é™·é˜±4ï¼šToken ä½¿ç”¨å¤±æ§
def bad_memory_management():
    messages = []
    for msg in conversation:
        messages.append(msg)  # æ°¸è¿œå¢é•¿

    response = llm.chat(messages)  # å¯èƒ½è¶…å‡º token é™åˆ¶

# âœ… æ”¹è¿›
def good_memory_management(max_tokens=4000):
    messages = []
    total_tokens = 0

    for msg in reversed(conversation):
        msg_tokens = count_tokens(msg)
        if total_tokens + msg_tokens > max_tokens:
            break
        messages.insert(0, msg)
        total_tokens += msg_tokens

    response = llm.chat(messages)
```

### 7.3 å®‰å…¨è€ƒè™‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®‰å…¨è€ƒè™‘æ¸…å•                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ”’ è¾“å…¥éªŒè¯                                                        â”‚
â”‚     â–¡ éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥                                              â”‚
â”‚     â–¡ éªŒè¯å·¥å…·å‚æ•°ç±»å‹å’ŒèŒƒå›´                                         â”‚
â”‚     â–¡ é˜²æ­¢æ³¨å…¥æ”»å‡»ï¼ˆSQLã€å‘½ä»¤ç­‰ï¼‰                                    â”‚
â”‚                                                                     â”‚
â”‚  ğŸ”’ æƒé™æ§åˆ¶                                                        â”‚
â”‚     â–¡ æœ€å°æƒé™åŸåˆ™                                                  â”‚
â”‚     â–¡ å·¥å…·è®¿é—®ç™½åå•                                                â”‚
â”‚     â–¡ æ•æ„Ÿæ“ä½œéœ€äºŒæ¬¡ç¡®è®¤                                            â”‚
â”‚                                                                     â”‚
â”‚  ğŸ”’ èµ„æºé™åˆ¶                                                        â”‚
â”‚     â–¡ API è°ƒç”¨é¢‘ç‡é™åˆ¶                                              â”‚
â”‚     â–¡ Token ä½¿ç”¨ä¸Šé™                                                â”‚
â”‚     â–¡ æ‰§è¡Œæ—¶é—´è¶…æ—¶                                                  â”‚
â”‚                                                                     â”‚
â”‚  ğŸ”’ å®¡è®¡æ—¥å¿—                                                        â”‚
â”‚     â–¡ è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨                                              â”‚
â”‚     â–¡ è®°å½•ç”¨æˆ·è¾“å…¥å’Œç³»ç»Ÿè¾“å‡º                                         â”‚
â”‚     â–¡ å¯è¿½æº¯çš„æ“ä½œé“¾è·¯                                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒæ¦‚å¿µå›é¡¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ ¸å¿ƒæ¦‚å¿µå›é¡¾                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Agent                                                             â”‚
â”‚   â”œâ”€â”€ å®šä¹‰ï¼šLLM + è®°å¿† + å·¥å…· + è§„åˆ’                                â”‚
â”‚   â”œâ”€â”€ æ ¸å¿ƒå¾ªç¯ï¼šæ„ŸçŸ¥ â†’ æ€è€ƒ â†’ å†³ç­– â†’ æ‰§è¡Œ â†’ è§‚å¯Ÿ                     â”‚
â”‚   â””â”€â”€ å…³é”®èƒ½åŠ›ï¼šè‡ªä¸»å†³ç­–ã€å·¥å…·ä½¿ç”¨ã€ä»»åŠ¡è§„åˆ’                          â”‚
â”‚                                                                     â”‚
â”‚   å·¥å…·è°ƒç”¨                                                          â”‚
â”‚   â”œâ”€â”€ æœºåˆ¶ï¼šLLM ç”Ÿæˆå·¥å…·è°ƒç”¨è¯·æ±‚ â†’ ç³»ç»Ÿæ‰§è¡Œ â†’ ç»“æœè¿”å› LLM           â”‚
â”‚   â”œâ”€â”€ å®šä¹‰ï¼šJSON Schema æè¿°å·¥å…·åç§°ã€æè¿°ã€å‚æ•°                     â”‚
â”‚   â””â”€â”€ å…³é”®ï¼šæ¸…æ™°çš„æè¿°å¸®åŠ© LLM æ­£ç¡®é€‰æ‹©å’Œä½¿ç”¨å·¥å…·                     â”‚
â”‚                                                                     â”‚
â”‚   ReAct                                                             â”‚
â”‚   â”œâ”€â”€ å«ä¹‰ï¼šReasoning + Acting äº¤ç»‡                                 â”‚
â”‚   â”œâ”€â”€ æµç¨‹ï¼šThought â†’ Action â†’ Observation â†’ å¾ªç¯                   â”‚
â”‚   â””â”€â”€ ä¼˜åŠ¿ï¼šå¯è§£é‡Šæ€§å¼ºã€èƒ½åŸºäºåé¦ˆè°ƒæ•´ç­–ç•¥                            â”‚
â”‚                                                                     â”‚
â”‚   MCP                                                               â”‚
â”‚   â”œâ”€â”€ å®šä¹‰ï¼šModel Context Protocolï¼Œæ ‡å‡†åŒ–è¿æ¥åè®®                   â”‚
â”‚   â”œâ”€â”€ ç»„ä»¶ï¼šHostã€Clientã€Server                                    â”‚
â”‚   â”œâ”€â”€ åŸè¯­ï¼šResourcesã€Toolsã€Prompts                               â”‚
â”‚   â””â”€â”€ ä»·å€¼ï¼šæ ‡å‡†åŒ–ã€å¯å¤ç”¨ã€å®‰å…¨                                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å­¦ä¹ è·¯å¾„å»ºè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   åˆçº§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   âœ… ç†è§£ Agent åŸºæœ¬æ¦‚å¿µ                                            â”‚
â”‚   âœ… å®ç°ç®€å•çš„å·¥å…·è°ƒç”¨                                             â”‚
â”‚   âœ… æŒæ¡ ReAct æ¨¡å¼                                                â”‚
â”‚                                                                     â”‚
â”‚   ä¸­çº§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   â–¡ å®ç°å®Œæ•´çš„ Agent ç³»ç»Ÿ                                           â”‚
â”‚   â–¡ é›†æˆ MCP åè®®                                                   â”‚
â”‚   â–¡ å®ç°å¤æ‚çš„è®°å¿†ç³»ç»Ÿ                                              â”‚
â”‚                                                                     â”‚
â”‚   é«˜çº§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   â–¡ å¤š Agent åä½œç³»ç»Ÿ                                               â”‚
â”‚   â–¡ è‡ªæˆ‘åæ€ä¸æ”¹è¿›                                                  â”‚
â”‚   â–¡ å¤æ‚ä»»åŠ¡è§„åˆ’ä¸åˆ†è§£                                              â”‚
â”‚   â–¡ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¸ä¼˜åŒ–                                              â”‚
â”‚                                                                     â”‚
â”‚   æ¨èèµ„æºï¼š                                                        â”‚
â”‚   â€¢ LangChain / LangGraph æ¡†æ¶                                      â”‚
â”‚   â€¢ AutoGPT / MetaGPT å¼€æºé¡¹ç›®                                      â”‚
â”‚   â€¢ MCP å®˜æ–¹æ–‡æ¡£                                                    â”‚
â”‚   â€¢ OpenAI Cookbook                                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ä½œè€…**: AI Learning Assistant
