"""
Agent åŸºç¡€æ¦‚å¿µ
=============

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£ä»€ä¹ˆæ˜¯ Agent
    2. æŒæ¡ Agent çš„æ ¸å¿ƒç»„ä»¶
    3. ç†è§£ Agent æ‰§è¡Œå¾ªç¯

æ ¸å¿ƒæ¦‚å¿µï¼š
    - Agentï¼šLLM + è®°å¿† + å·¥å…· + è§„åˆ’
    - æ‰§è¡Œå¾ªç¯ï¼šæ„ŸçŸ¥ â†’ æ€è€ƒ â†’ å†³ç­– â†’ æ‰§è¡Œ â†’ è§‚å¯Ÿ
    - Agent vs ä¼ ç»Ÿ LLM

å‰ç½®çŸ¥è¯†ï¼š
    - Phase 1-5 çš„æ‰€æœ‰å†…å®¹

ç¯å¢ƒè¦æ±‚ï¼š
    - pip install openai python-dotenv
"""

import os
from dotenv import load_dotenv

load_dotenv()


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯ Agent ====================


def what_is_agent():
    """ä»€ä¹ˆæ˜¯ Agent"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯ Agent")
    print("=" * 60)

    print("""
    Agentï¼ˆæ™ºèƒ½ä½“ï¼‰çš„å®šä¹‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    Agent = LLM + è®°å¿† + å·¥å…· + è§„åˆ’èƒ½åŠ›
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Agent æ¶æ„                        â”‚
    â”‚                                                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚   LLM   â”‚  â”‚  Memory â”‚  â”‚  Tools  â”‚  â”‚Planningâ”‚ â”‚
    â”‚  â”‚  å¤§è„‘   â”‚  â”‚  è®°å¿†   â”‚  â”‚  å·¥å…·   â”‚  â”‚  è§„åˆ’  â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                     â”‚
    â”‚  Agent æ˜¯èƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–ã€æ‰§è¡Œè¡ŒåŠ¨çš„ç³»ç»Ÿ    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Agent çš„æ ¸å¿ƒèƒ½åŠ›ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ğŸ§  ç†è§£ï¼šåˆ†æç”¨æˆ·æ„å›¾å’Œä¸Šä¸‹æ–‡
    ğŸ¤” è§„åˆ’ï¼šåˆ†è§£ä»»åŠ¡ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’
    ğŸ”§ è¡ŒåŠ¨ï¼šè°ƒç”¨å·¥å…·æ‰§è¡Œå…·ä½“æ“ä½œ
    ğŸ”„ è¿­ä»£ï¼šæ ¹æ®åé¦ˆè°ƒæ•´ç­–ç•¥
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šAgent vs ä¼ ç»Ÿ LLM ====================


def agent_vs_llm():
    """Agent ä¸ä¼ ç»Ÿ LLM å¯¹æ¯”"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šAgent vs ä¼ ç»Ÿ LLM")
    print("=" * 60)

    print("""
    ä¼ ç»Ÿ LLM çš„å±€é™æ€§
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ç”¨æˆ·: "ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
    
    ä¼ ç»Ÿ LLM å›å¤:
    âŒ "æˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼Œæˆ‘çš„çŸ¥è¯†æˆªæ­¢äº..."
    
    Agent å›å¤:
    âœ… "è®©æˆ‘æŸ¥è¯¢ä¸€ä¸‹...æ ¹æ®æŸ¥è¯¢ï¼Œä»Šå¤©åŒ—äº¬æ™´æœ—ï¼Œ25Â°Cã€‚"
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     ä¼ ç»Ÿ LLM       â”‚           Agent                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ å•è½®å¯¹è¯           â”‚ å¤šè½®æ¨ç†å¾ªç¯                    â”‚
    â”‚ é™æ€çŸ¥è¯†           â”‚ åŠ¨æ€è·å–ä¿¡æ¯                    â”‚
    â”‚ æ— æ³•æ‰§è¡Œæ“ä½œ       â”‚ å¯æ‰§è¡ŒçœŸå®æ“ä½œ                  â”‚
    â”‚ è¢«åŠ¨å“åº”           â”‚ ä¸»åŠ¨å®Œæˆä»»åŠ¡                    â”‚
    â”‚ çŸ¥è¯†æœ‰æˆªæ­¢æ—¥æœŸ     â”‚ é€šè¿‡å·¥å…·è·å–å®æ—¶ä¿¡æ¯            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šAgent æ ¸å¿ƒç»„ä»¶ ====================


def agent_components():
    """Agent æ ¸å¿ƒç»„ä»¶"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šAgent æ ¸å¿ƒç»„ä»¶")
    print("=" * 60)

    print("""
    1. LLMï¼ˆå¤§è„‘ï¼‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - ç†è§£ç”¨æˆ·è¾“å…¥
    - æ¨ç†å’Œå†³ç­–
    - ç”Ÿæˆå›å¤
    
    2. è®°å¿†ç³»ç»Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - çŸ­æœŸè®°å¿†ï¼šå½“å‰å¯¹è¯å†å²
    - é•¿æœŸè®°å¿†ï¼šå‘é‡æ•°æ®åº“å­˜å‚¨
    - å·¥ä½œè®°å¿†ï¼šå½“å‰ä»»åŠ¡çŠ¶æ€
    
    3. å·¥å…·é›†åˆ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - æœç´¢å·¥å…·ï¼šè·å–å®æ—¶ä¿¡æ¯
    - è®¡ç®—å·¥å…·ï¼šæ‰§è¡Œæ•°å­¦è¿ç®—
    - API å·¥å…·ï¼šä¸å¤–éƒ¨æœåŠ¡äº¤äº’
    - ä»£ç æ‰§è¡Œå™¨ï¼šè¿è¡Œä»£ç 
    
    4. è§„åˆ’æ¨¡å—
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - ä»»åŠ¡åˆ†è§£ï¼šå°†å¤æ‚ä»»åŠ¡æ‹†åˆ†
    - æ­¥éª¤æ’åºï¼šç¡®å®šæ‰§è¡Œé¡ºåº
    - èµ„æºåˆ†é…ï¼šé€‰æ‹©åˆé€‚å·¥å…·
    """)

    # ç»„ä»¶ä»£ç ç¤ºä¾‹
    print("\nğŸ“Œ ç»„ä»¶ä»£ç ç¤ºä¾‹ï¼š")

    code_example = '''
class AgentComponent:
    """Agent æ ¸å¿ƒç»„ä»¶æŠ½è±¡"""
    
    def __init__(self):
        # 1. LLM å¤§è„‘
        self.llm = None  # GPT-4, Claude ç­‰
        
        # 2. è®°å¿†ç³»ç»Ÿ
        self.short_term_memory = []  # å¯¹è¯å†å²
        self.long_term_memory = None  # å‘é‡æ•°æ®åº“
        
        # 3. å·¥å…·é›†åˆ
        self.tools = {}  # å¯ç”¨å·¥å…·å­—å…¸
        
        # 4. è§„åˆ’æ¨¡å—
        self.planner = None  # ä»»åŠ¡è§„åˆ’å™¨
'''
    print(code_example)


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šAgent æ‰§è¡Œå¾ªç¯ ====================


def agent_loop():
    """Agent æ‰§è¡Œå¾ªç¯"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šAgent æ‰§è¡Œå¾ªç¯")
    print("=" * 60)

    print("""
    Agent æ‰§è¡Œå¾ªç¯ (Agent Loop)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                              â”‚
              â–¼                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”‚   æ„ŸçŸ¥      â”‚  æ¥æ”¶è¾“å…¥             â”‚
        â”‚  Perceive   â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
               â”‚                             â”‚
               â–¼                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”‚   æ€è€ƒ      â”‚  LLM æ¨ç†            â”‚
        â”‚   Think     â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
               â”‚                             â”‚
               â–¼                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   å†³ç­–      â”‚â”€â”€æ˜¯â”€â”€â”‚éœ€è¦å·¥å…·ï¼Ÿâ”‚   â”‚
        â”‚  Decide     â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚å¦       â”‚
               â”‚                  â–¼         â”‚
               â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
               â”‚           â”‚ ç›´æ¥å›å¤ â”‚â”€â”€â”€â”€â”€â”¤
               â–¼           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
        â”‚   æ‰§è¡Œ      â”‚  è°ƒç”¨å·¥å…·            â”‚
        â”‚    Act      â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
               â”‚                            â”‚
               â–¼                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   è§‚å¯Ÿ      â”‚â”€â”€å¦â”€â”€â”‚ä»»åŠ¡å®Œæˆï¼Ÿâ”‚â”€â”€â”€â”˜
        â”‚  Observe    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚æ˜¯
                                  â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ è¿”å›ç»“æœ â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šç®€å• Agent å®ç° ====================


def simple_agent_demo():
    """ç®€å• Agent å®ç°æ¼”ç¤º"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šç®€å• Agent å®ç°")
    print("=" * 60)

    class SimpleAgent:
        """æœ€ç®€å•çš„ Agent å®ç°"""

        def __init__(self):
            self.tools = {
                "calculator": self.calculator,
                "search": self.search,
            }
            self.memory = []

        def calculator(self, expression: str) -> str:
            """è®¡ç®—å™¨å·¥å…·"""
            try:
                result = eval(expression, {"__builtins__": {}})
                return f"è®¡ç®—ç»“æœ: {result}"
            except Exception as e:
                return f"è®¡ç®—é”™è¯¯: {e}"

        def search(self, query: str) -> str:
            """æ¨¡æ‹Ÿæœç´¢å·¥å…·"""
            # æ¨¡æ‹Ÿæœç´¢ç»“æœ
            mock_results = {
                "å¤©æ°”": "ä»Šå¤©åŒ—äº¬æ™´æœ—ï¼Œæ°”æ¸© 25Â°C",
                "æ–°é—»": "ä»Šæ—¥ç§‘æŠ€æ–°é—»ï¼šAI æŠ€æœ¯æŒç»­å‘å±•",
            }
            for key, value in mock_results.items():
                if key in query:
                    return value
            return f"æœç´¢ '{query}' çš„ç»“æœï¼šæš‚æ— ç›¸å…³ä¿¡æ¯"

        def think(self, user_input: str) -> dict:
            """æ€è€ƒï¼šå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨"""
            # ç®€å•è§„åˆ™åˆ¤æ–­ï¼ˆå®é™…åº”ç”¨ä¸­ç”± LLM å†³å®šï¼‰
            if any(op in user_input for op in ["+", "-", "*", "/", "è®¡ç®—"]):
                return {
                    "action": "tool",
                    "tool": "calculator",
                    "input": user_input.replace("è®¡ç®—", "").strip(),
                }
            elif "æœç´¢" in user_input or "æŸ¥è¯¢" in user_input or "å¤©æ°”" in user_input:
                return {"action": "tool", "tool": "search", "input": user_input}
            else:
                return {"action": "respond", "content": f"æˆ‘ç†è§£ä½ è¯´çš„æ˜¯ï¼š{user_input}"}

        def run(self, user_input: str) -> str:
            """è¿è¡Œ Agent"""
            print(f"ğŸ“¥ ç”¨æˆ·è¾“å…¥: {user_input}")

            # æ·»åŠ åˆ°è®°å¿†
            self.memory.append({"role": "user", "content": user_input})

            # æ€è€ƒ
            thought = self.think(user_input)
            print(f"ğŸ¤” æ€è€ƒç»“æœ: {thought}")

            # æ‰§è¡Œ
            if thought["action"] == "tool":
                tool_name = thought["tool"]
                tool_input = thought["input"]
                print(f"ğŸ”§ è°ƒç”¨å·¥å…·: {tool_name}({tool_input})")

                result = self.tools[tool_name](tool_input)
                print(f"ğŸ“¤ å·¥å…·è¿”å›: {result}")

                response = result
            else:
                response = thought["content"]

            # ä¿å­˜å“åº”
            self.memory.append({"role": "assistant", "content": response})

            return response

    # æ¼”ç¤º
    agent = SimpleAgent()

    print("\nğŸ“Œ æµ‹è¯• 1ï¼šè®¡ç®—ä»»åŠ¡")
    print("-" * 40)
    result1 = agent.run("è®¡ç®— 15 * 8 + 20")
    print(f"âœ… æœ€ç»ˆå›å¤: {result1}")

    print("\nğŸ“Œ æµ‹è¯• 2ï¼šæœç´¢ä»»åŠ¡")
    print("-" * 40)
    result2 = agent.run("æŸ¥è¯¢ä»Šå¤©çš„å¤©æ°”")
    print(f"âœ… æœ€ç»ˆå›å¤: {result2}")

    print("\nğŸ“Œ æµ‹è¯• 3ï¼šæ™®é€šå¯¹è¯")
    print("-" * 40)
    result3 = agent.run("ä½ å¥½ï¼Œæˆ‘æƒ³å­¦ä¹  Agent")
    print(f"âœ… æœ€ç»ˆå›å¤: {result3}")


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šç»ƒä¹ ä¸æ€è€ƒ ====================


def exercises():
    """ç»ƒä¹ é¢˜"""
    print("\n" + "=" * 60)
    print("ç»ƒä¹ ä¸æ€è€ƒ")
    print("=" * 60)

    print("""
    ç»ƒä¹  1ï¼šæ‰©å±•å·¥å…·
        ä¸ºä¸Šé¢çš„ SimpleAgent æ·»åŠ ä¸€ä¸ªæ–°å·¥å…·ï¼Œæ¯”å¦‚ï¼š
        - ç¿»è¯‘å·¥å…·ï¼ˆæ¨¡æ‹Ÿï¼‰
        - æ—¥æœŸæ—¶é—´å·¥å…·
    
    ç»ƒä¹  2ï¼šæ”¹è¿›å†³ç­–é€»è¾‘
        ä½¿ç”¨å…³é”®è¯åŒ¹é…ä¹‹å¤–çš„æ–¹å¼æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·¥å…·ã€‚
    
    ç»ƒä¹  3ï¼šé›†æˆçœŸå® LLM
        å°† think() æ–¹æ³•æ”¹ä¸ºè°ƒç”¨ OpenAI API æ¥å†³ç­–ã€‚
    
    æ€è€ƒé¢˜ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€
    1. Agent çš„è®°å¿†ç³»ç»Ÿåº”è¯¥å¦‚ä½•è®¾è®¡æ‰èƒ½é«˜æ•ˆï¼Ÿ
       ç­”ï¼šçŸ­æœŸè®°å¿†ä¿å­˜æœ€è¿‘å¯¹è¯ï¼Œé•¿æœŸè®°å¿†åšå‘é‡åŒ–å­˜å‚¨å’Œæ£€ç´¢ï¼Œ
       å·¥ä½œè®°å¿†è·Ÿè¸ªå½“å‰ä»»åŠ¡çŠ¶æ€ã€‚
    
    2. å¦‚æœå·¥å…·æ‰§è¡Œå¤±è´¥ï¼ŒAgent åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ
       ç­”ï¼šå¯ä»¥é‡è¯•ã€å°è¯•å…¶ä»–å·¥å…·ã€æˆ–å‘ç”¨æˆ·æŠ¥å‘Šé”™è¯¯å¹¶è¯·æ±‚æ¾„æ¸…ã€‚
    
    3. Agent æœ€å¤šåº”è¯¥æ‰§è¡Œå¤šå°‘æ­¥ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦é™åˆ¶ï¼Ÿ
       ç­”ï¼šé€šå¸¸é™åˆ¶ 5-10 æ­¥ï¼Œé˜²æ­¢æ— é™å¾ªç¯å’Œè¿‡åº¦æ¶ˆè€—èµ„æºã€‚
    """)


# ==================== ä¸»å‡½æ•° ====================


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ¤– Agent åŸºç¡€æ¦‚å¿µ")
    print("=" * 60)

    what_is_agent()
    agent_vs_llm()
    agent_components()
    agent_loop()
    simple_agent_demo()
    exercises()

    print("\n" + "=" * 60)
    print("âœ… è¯¾ç¨‹å®Œæˆï¼ä¸‹ä¸€æ­¥ï¼š02-react-agent.py")
    print("=" * 60)


if __name__ == "__main__":
    main()
