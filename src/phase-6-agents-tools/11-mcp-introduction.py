"""
MCP åè®®ä»‹ç»
===========

å­¦ä¹ ç›®æ ‡ï¼š
    1. ç†è§£ MCP (Model Context Protocol) æ¦‚å¿µ
    2. äº†è§£ MCP æ¶æ„å’Œç»„ä»¶
    3. ç†è§£ MCP çš„åº”ç”¨åœºæ™¯

æ ¸å¿ƒæ¦‚å¿µï¼š
    - MCPï¼šæ¨¡å‹ä¸Šä¸‹æ–‡åè®®
    - Serverï¼šæä¾›å·¥å…·å’Œèµ„æº
    - Clientï¼šè°ƒç”¨ Server çš„æœåŠ¡
    - Transportï¼šé€šä¿¡å±‚

å‰ç½®çŸ¥è¯†ï¼š
    - 01-10 æ‰€æœ‰ Agent è¯¾ç¨‹

ç¯å¢ƒè¦æ±‚ï¼š
    - pip install mcp python-dotenv
"""

import os
from dotenv import load_dotenv

load_dotenv()


# ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯ MCP ====================


def what_is_mcp():
    """ä»€ä¹ˆæ˜¯ MCP"""
    print("=" * 60)
    print("ç¬¬ä¸€éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯ MCP")
    print("=" * 60)

    print("""
    MCP (Model Context Protocol)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    MCP æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œç”¨äºæ ‡å‡†åŒ– AI æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·/èµ„æºçš„äº¤äº’ã€‚
    
    æ ¸å¿ƒç†å¿µï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ å°†å·¥å…·å’Œèµ„æºå°è£…ä¸ºç‹¬ç«‹æœåŠ¡ï¼ˆServerï¼‰
    â€¢ é€šè¿‡ç»Ÿä¸€åè®®ä¸ AI æ¨¡å‹äº¤äº’
    â€¢ è§£è€¦ AI åº”ç”¨ä¸å…·ä½“å®ç°
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     MCP æ¶æ„                            â”‚
    â”‚                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚ AI æ¨¡å‹  â”‚ â”€â”€â†’  â”‚ MCP Clientâ”‚ â”€â”€â†’  â”‚MCP Serverâ”‚    â”‚
    â”‚  â”‚ (LLM)   â”‚       â”‚          â”‚       â”‚          â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                                              â”‚          â”‚
    â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚                                     â–¼        â–¼       â–¼ â”‚
    â”‚                                  [å·¥å…·]  [èµ„æº]  [æç¤º] â”‚
    â”‚                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ä¸ºä»€ä¹ˆéœ€è¦ MCPï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ… æ ‡å‡†åŒ–ï¼šç»Ÿä¸€çš„å·¥å…·è°ƒç”¨åè®®
    âœ… å¯å¤ç”¨ï¼šServer å¯è¢«å¤šä¸ª Client ä½¿ç”¨
    âœ… è§£è€¦ï¼šAI åº”ç”¨ä¸å·¥å…·å®ç°åˆ†ç¦»
    âœ… ç”Ÿæ€ï¼šå…±äº«å·¥å…·æœåŠ¡ç”Ÿæ€ç³»ç»Ÿ
    """)


# ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šMCP æ ¸å¿ƒç»„ä»¶ ====================


def mcp_components():
    """MCP æ ¸å¿ƒç»„ä»¶"""
    print("\n" + "=" * 60)
    print("ç¬¬äºŒéƒ¨åˆ†ï¼šMCP æ ¸å¿ƒç»„ä»¶")
    print("=" * 60)

    print("""
    MCP æ ¸å¿ƒç»„ä»¶
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. Serverï¼ˆæœåŠ¡ç«¯ï¼‰
       â€¢ æä¾›å·¥å…·ï¼ˆToolsï¼‰
       â€¢ æä¾›èµ„æºï¼ˆResourcesï¼‰
       â€¢ æä¾›æç¤ºæ¨¡æ¿ï¼ˆPromptsï¼‰
    
    2. Clientï¼ˆå®¢æˆ·ç«¯ï¼‰
       â€¢ è¿æ¥ Server
       â€¢ è°ƒç”¨å·¥å…·
       â€¢ è·å–èµ„æº
    
    3. Transportï¼ˆä¼ è¾“å±‚ï¼‰
       â€¢ stdioï¼šæ ‡å‡†è¾“å…¥è¾“å‡º
       â€¢ HTTP/SSEï¼šç½‘ç»œé€šä¿¡
    
    MCP Server èƒ½åŠ›
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                MCP Server                    â”‚
    â”‚                                              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  Tools   â”‚  â”‚Resources â”‚  â”‚ Prompts  â”‚  â”‚
    â”‚  â”‚ (å·¥å…·)   â”‚  â”‚ (èµ„æº)   â”‚  â”‚ (æç¤º)   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                              â”‚
    â”‚  å·¥å…·ï¼šå¯æ‰§è¡Œçš„æ“ä½œï¼ˆæœç´¢ã€è®¡ç®—ç­‰ï¼‰            â”‚
    â”‚  èµ„æºï¼šé™æ€å†…å®¹ï¼ˆæ–‡æ¡£ã€æ•°æ®ç­‰ï¼‰               â”‚
    â”‚  æç¤ºï¼šé¢„å®šä¹‰çš„æç¤ºæ¨¡æ¿                      â”‚
    â”‚                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)


# ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šMCP é€šä¿¡æµç¨‹ ====================


def mcp_communication():
    """MCP é€šä¿¡æµç¨‹"""
    print("\n" + "=" * 60)
    print("ç¬¬ä¸‰éƒ¨åˆ†ï¼šMCP é€šä¿¡æµç¨‹")
    print("=" * 60)

    print("""
    MCP é€šä¿¡æµç¨‹
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. åˆå§‹åŒ–è¿æ¥
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Client â”‚ â”€â”€ initialize â”€â”€â†’ â”‚ Server â”‚
    â”‚        â”‚ â†â”€â”€ capabilities â”€â”€â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    2. è·å–å¯ç”¨å·¥å…·
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Client â”‚ â”€â”€ tools/list â”€â”€â†’ â”‚ Server â”‚
    â”‚        â”‚ â†â”€â”€ tool list â”€â”€â”€â”€â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    3. è°ƒç”¨å·¥å…·
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Client â”‚ â”€â”€ tools/call â”€â”€â†’ â”‚ Server â”‚
    â”‚        â”‚ â†â”€â”€ result â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    æ¶ˆæ¯æ ¼å¼ï¼ˆJSON-RPC 2.0ï¼‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    è¯·æ±‚ï¼š
    {
        "jsonrpc": "2.0",
        "id": 1,
        "method": "tools/call",
        "params": {
            "name": "get_weather",
            "arguments": {"city": "åŒ—äº¬"}
        }
    }
    
    å“åº”ï¼š
    {
        "jsonrpc": "2.0",
        "id": 1,
        "result": {
            "content": [{"type": "text", "text": "åŒ—äº¬ï¼šæ™´ï¼Œ25Â°C"}]
        }
    }
    """)


# ==================== ç¬¬å››éƒ¨åˆ†ï¼šMCP åº”ç”¨åœºæ™¯ ====================


def mcp_use_cases():
    """MCP åº”ç”¨åœºæ™¯"""
    print("\n" + "=" * 60)
    print("ç¬¬å››éƒ¨åˆ†ï¼šMCP åº”ç”¨åœºæ™¯")
    print("=" * 60)

    print("""
    MCP åº”ç”¨åœºæ™¯
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. æ–‡ä»¶ç³»ç»Ÿè®¿é—®
       â€¢ è¯»å†™æœ¬åœ°æ–‡ä»¶
       â€¢ ç›®å½•éå†
       â€¢ æ–‡ä»¶æœç´¢
    
    2. æ•°æ®åº“æ“ä½œ
       â€¢ SQL æŸ¥è¯¢æ‰§è¡Œ
       â€¢ æ•°æ®å¯¼å…¥å¯¼å‡º
       â€¢ æ¨¡å¼ç®¡ç†
    
    3. API é›†æˆ
       â€¢ ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨
       â€¢ æ•°æ®è·å–å’Œå¤„ç†
    
    4. å¼€å‘å·¥å…·
       â€¢ ä»£ç åˆ†æ
       â€¢ é¡¹ç›®ç®¡ç†
       â€¢ æµ‹è¯•æ‰§è¡Œ
    
    å…¸å‹ MCP Server ç¤ºä¾‹
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    â”‚ Server              â”‚ åŠŸèƒ½                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ filesystem          â”‚ æ–‡ä»¶è¯»å†™æ“ä½œ            â”‚
    â”‚ sqlite              â”‚ SQLite æ•°æ®åº“æ“ä½œ       â”‚
    â”‚ github              â”‚ GitHub API é›†æˆ        â”‚
    â”‚ slack               â”‚ Slack æ¶ˆæ¯å‘é€         â”‚
    â”‚ web-search          â”‚ ç½‘ç»œæœç´¢               â”‚
    """)


# ==================== ç¬¬äº”éƒ¨åˆ†ï¼šMCP vs Function Calling ====================


def mcp_vs_function_calling():
    """MCP vs Function Calling"""
    print("\n" + "=" * 60)
    print("ç¬¬äº”éƒ¨åˆ†ï¼šMCP vs Function Calling")
    print("=" * 60)

    print("""
    MCP vs OpenAI Function Calling
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    â”‚ ç‰¹æ€§      â”‚ Function Calling  â”‚ MCP              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ æ ‡å‡†åŒ–    â”‚ OpenAI ä¸“æœ‰       â”‚ å¼€æ”¾åè®®         â”‚
    â”‚ å¯ç§»æ¤æ€§  â”‚ ç»‘å®š OpenAI       â”‚ è·¨å¹³å°           â”‚
    â”‚ å·¥å…·å¤ç”¨  â”‚ éœ€é‡å¤å®šä¹‰        â”‚ Server å¯å…±äº«    â”‚
    â”‚ éƒ¨ç½²æ–¹å¼  â”‚ åµŒå…¥åº”ç”¨          â”‚ ç‹¬ç«‹æœåŠ¡         â”‚
    â”‚ ç”Ÿæ€ç³»ç»Ÿ  â”‚ OpenAI ç”Ÿæ€       â”‚ å¼€æ”¾ç”Ÿæ€         â”‚
    
    ä½•æ—¶é€‰æ‹© MCPï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ éœ€è¦è·¨å¤šä¸ª AI å¹³å°ä½¿ç”¨å·¥å…·
    â€¢ å¸Œæœ›å·¥å…·æœåŠ¡ç‹¬ç«‹éƒ¨ç½²å’Œç®¡ç†
    â€¢ éœ€è¦ä¸ç¤¾åŒºå…±äº«å·¥å…·
    â€¢ æ„å»ºä¼ä¸šçº§ AI åº”ç”¨
    
    ä½•æ—¶é€‰æ‹© Function Callingï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ åªä½¿ç”¨ OpenAI API
    â€¢ ç®€å•åœºæ™¯ï¼Œå¿«é€ŸåŸå‹
    â€¢ å·¥å…·é€»è¾‘ç®€å•ï¼ŒåµŒå…¥åº”ç”¨å³å¯
    """)


# ==================== ç¬¬å…­éƒ¨åˆ†ï¼šç»ƒä¹  ====================


def exercises():
    """ç»ƒä¹ é¢˜"""
    print("\n" + "=" * 60)
    print("ç»ƒä¹ ä¸æ€è€ƒ")
    print("=" * 60)

    print("""
    ç»ƒä¹  1ï¼šäº†è§£ MCP ç”Ÿæ€
        è®¿é—® https://modelcontextprotocol.io 
        äº†è§£ç°æœ‰çš„ MCP Server

        âœ… å‚è€ƒç­”æ¡ˆï¼š
        å¸¸è§çš„ MCP Server ç±»å‹ï¼š
        - æ–‡ä»¶ç³»ç»Ÿ Serverï¼šè¯»å†™æ–‡ä»¶ã€ç›®å½•æ“ä½œ
        - æ•°æ®åº“ Serverï¼šSQL æŸ¥è¯¢ã€æ•°æ®æ“ä½œ
        - Web æœç´¢ Serverï¼šBraveã€Serper ç­‰
        - GitHub Serverï¼šä»“åº“ç®¡ç†ã€ä»£ç æœç´¢
        - Slack Serverï¼šæ¶ˆæ¯å‘é€ã€é¢‘é“ç®¡ç†
        - æµè§ˆå™¨ Serverï¼šç½‘é¡µæŠ“å–ã€è‡ªåŠ¨åŒ–
        
        å®‰è£…ç¤ºä¾‹ï¼š
        ```bash
        # ä½¿ç”¨ npx è¿è¡Œå®˜æ–¹ Server
        npx -y @modelcontextprotocol/server-filesystem /path/to/dir
        
        # æˆ–ä½¿ç”¨ uvx è¿è¡Œ Python Server
        uvx mcp-server-sqlite --db-path /path/to/db.sqlite
        ```
    
    ç»ƒä¹  2ï¼šå¯¹æ¯”åˆ†æ
        åˆ—å‡ºä½ çš„é¡¹ç›®é€‚åˆç”¨ MCP è¿˜æ˜¯ Function Calling

        âœ… å‚è€ƒç­”æ¡ˆï¼š
        
        é€‰æ‹© MCP çš„åœºæ™¯ï¼š
        - éœ€è¦å¤šä¸ª AI åº”ç”¨å…±äº«å·¥å…·
        - å·¥å…·é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç‹¬ç«‹ç»´æŠ¤
        - éœ€è¦è·¨è¯­è¨€æ”¯æŒ
        - éœ€è¦ä¸ Claude Desktop ç­‰é›†æˆ
        
        é€‰æ‹© Function Calling çš„åœºæ™¯ï¼š
        - å·¥å…·ç®€å•ï¼Œç›´æ¥åµŒå…¥åº”ç”¨
        - å•ä¸€ LLM æä¾›å•†
        - å¯¹å»¶è¿Ÿæ•æ„Ÿ
        - å¿«é€ŸåŸå‹å¼€å‘
        
        æ··åˆä½¿ç”¨ç¤ºä¾‹ï¼š
        ```python
        # ç®€å•å·¥å…·ç”¨ Function Calling
        @tool
        def calculate(expr: str) -> str:
            return str(eval(expr))
        
        # å¤æ‚å·¥å…·ç”¨ MCP
        mcp_client.connect("file-server")
        mcp_client.call_tool("read_file", {"path": "/data/file.txt"})
        ```
    
    æ€è€ƒé¢˜ï¼š
        MCP å¦‚ä½•ç¡®ä¿å·¥å…·è°ƒç”¨çš„å®‰å…¨æ€§ï¼Ÿ
        ç­”ï¼šé€šè¿‡æƒé™æ§åˆ¶ã€æ²™ç®±æ‰§è¡Œã€è¾“å…¥éªŒè¯ç­‰æœºåˆ¶

        âœ… è¯¦ç»†ç­”æ¡ˆï¼š
        - ä¼ è¾“å±‚å®‰å…¨ï¼šä½¿ç”¨ stdio æˆ–å®‰å…¨ SSE
        - æƒé™éš”ç¦»ï¼šæ¯ä¸ª Server ç‹¬ç«‹è¿›ç¨‹
        - è¾“å…¥éªŒè¯ï¼šSchema å®šä¹‰å¼ºç±»å‹å‚æ•°
        - èƒ½åŠ›åå•†ï¼šClient å’Œ Server åå•†æƒé™
        - å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨
    """)


def main():
    print("ğŸ”Œ MCP åè®®ä»‹ç»")
    print("=" * 60)

    what_is_mcp()
    mcp_components()
    mcp_communication()
    mcp_use_cases()
    mcp_vs_function_calling()
    exercises()

    print("\n" + "=" * 60)
    print("âœ… è¯¾ç¨‹å®Œæˆï¼ä¸‹ä¸€æ­¥ï¼š12-mcp-server-basics.py")
    print("=" * 60)


if __name__ == "__main__":
    main()
